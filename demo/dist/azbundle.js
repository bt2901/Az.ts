var t={520:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=r(301);class i extends s.ByteDawg{constructor(t,e){super(t),this.dictionary=t,this.guide=e}hasBytesWithPrefix(t){return!this.completionsBytes(t).next().done}*completionsBytes(t){let e=this.dictionary.followBytes(t);null!==e&&(yield*function*(t,e,r){let s=new Array,i=[r];for(;i.length;){for(;!t.hasValue(r);){let o=e.child(r);if(null===(r=t.followByte(o,r)))return;s.push(o),i.push(r)}yield s;let o=e.child(r);if(o){if(null===(r=t.followByte(o,r)))return;s.push(o),i.push(r)}else for(;;){if(i.pop(),!i.length)return;s.pop();let o=e.sibling(r);if(r=i[i.length-1],o){if(null===(r=t.followByte(o,r)))return;s.push(o),i.push(r);break}}}}(this.dictionary,this.guide,e))}completionsBytesArray(t){let e=this.dictionary.followBytes(t);return null===e?[]:function(t,e,r){let s=new Array,i=new Array,o=[r];for(;o.length;){for(;!t.hasValue(r);){let n=e.child(r);if(null===(r=t.followByte(n,r)))return s;i.push(n),o.push(r)}s.push([...i]);let n=e.child(r);if(n){if(null===(r=t.followByte(n,r)))return s;i.push(n),o.push(r)}else for(;;){if(o.pop(),!o.length)return s;i.pop();let n=e.sibling(r);if(r=o[o.length-1],n){if(null===(r=t.followByte(n,r)))return s;i.push(n),o.push(r);break}}}return s}(this.dictionary,this.guide,e)}}e.ByteCompletionDawg=i},301:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ByteDawg=class{constructor(t){this.dictionary=t}hasBytes(t){return this.dictionary.has(t)}}},170:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=r(153);e.ByteMapDawg=class{constructor(t,e=1,r=!1){this.dawg=t,this.payloadSeparator=e,this.binasciiWorkaround=r}hasBytes(t){return this.dawg.hasBytesWithPrefix([...t,this.payloadSeparator])}*getBytes(t){for(let e of this.dawg.completionsBytes([...t,this.payloadSeparator]))this.binasciiWorkaround&&(e=e.slice(0,-1)),yield s.b64decodeFromArray(e)}getBytesArray(t){let e=new Array,r=this.dawg.completionsBytesArray([...t,this.payloadSeparator]);for(let t=0;t<r.length;++t){let i=r[t];this.binasciiWorkaround&&(i=i.slice(0,-1)),e.push(s.b64decodeFromArray(i))}return e}}},153:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.encodeUtf8=function(t){let e=new Array;for(let r=0;r<t.length;++r){let s=t.charCodeAt(r);s<128?e.push(s):s<2048?(e.push(s>>>6|192),e.push(63&s|128)):(e.push(s>>>12|224),e.push(s>>>6&63|128),e.push(63&s|128))}return e},e.decodeUtf8=function(t){let e="";for(let r=0;r<t.length;++r){let s=t[r];if(s<128)e+=String.fromCharCode(s);else if(s>191&&s<224){let i=t[++r];e+=String.fromCharCode((31&s)<<6|63&i)}else{let i=t[++r],o=t[++r];e+=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e};const r=[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].map((t=>t.codePointAt(0))),s="+".charCodeAt(0),i="/".charCodeAt(0),o="0".charCodeAt(0),n="a".charCodeAt(0),a="A".charCodeAt(0),h="-".charCodeAt(0),f="_".charCodeAt(0),l="=".charCodeAt(0);function c(t){if(t===s||t===h)return 62;if(t===i||t===f)return 63;if(t<o+10)return t-o+26+26;if(t<a+26)return t-a;if(t<n+26)return t-n+26;if(t<o)throw""}e.b64decodeFromArray=function(t){let e,r=t.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");e=t[r-2]===l?2:t[r-1]===l?1:0;let s=new Uint8Array(3*r/4-e),i=0,o=e>0?r-4:r,n=0;for(let e=0;n<o;n+=4,e+=3){let e=c(t[n])<<18|c(t[n+1])<<12|c(t[n+2])<<6|c(t[n+3]);s[i++]=(16711680&e)>>16,s[i++]=(65280&e)>>8,s[i++]=255&e}if(2===e){let e=c(t[n])<<2|c(t[n+1])>>4;s[i++]=255&e}else if(1===e){let e=c(t[n])<<10|c(t[n+1])<<4|c(t[n+2])>>2;s[i++]=e>>8&255,s[i++]=255&e}return s},e.b64encode=function(t){let e,s=new Array,i=0;for(let o=0;o<t.length/3;++o)e=t[i++]<<16,e+=t[i++]<<8,e+=t[i++],s.push(r[(16515072&e)>>18]),s.push(r[(258048&e)>>12]),s.push(r[(4032&e)>>6]),s.push(r[63&e]);switch(t.length%3){case 1:e=t[i++]<<16,s.push(r[(16515072&e)>>18]),s.push(r[(258048&e)>>12]),s.push(l,l);break;case 2:e=t[i++]<<16,e+=t[i++]<<8,s.push(r[(16515072&e)>>18]),s.push(r[(258048&e)>>12]),s.push(r[(4032&e)>>6]),s.push(l)}return s}},534:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=r(290);class i extends s.Dawg{constructor(t,e,r){super(t,e),this.dawg=t,this.keyDecoder=r}hasWithPrefix(t){return this.dawg.hasBytesWithPrefix(this.keyEncoder(t))}*completions(t){for(let e of this.dawg.completionsBytes(this.keyEncoder(t)))yield this.keyDecoder(e)}}e.CompletionDawg=i},290:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Dawg=class{constructor(t,e){this.dawg=t,this.keyEncoder=e}has(t){return this.dawg.hasBytes(this.keyEncoder(t))}}},767:(t,e)=>{var r;Object.defineProperty(e,"__esModule",{value:!0}),e.Dictionary=class{constructor(t){this.units=t}has(t){let e=this.followBytes(t);return null!==e&&r.hasLeaf(this.units[e])}hasValue(t){return r.hasLeaf(this.units[t])}value(t){return r.value(this.units[t^r.offset(this.units[t])])}followBytes(t,e=0){for(let r of t)if(null===(e=this.followByte(r,e)))return null;return e}followByte(t,e){let s=e^r.offset(this.units[e])^t;return r.label(this.units[s])!==t?null:s}},function(t){t.hasLeaf=function(t){return!!(256&t)},t.value=function(t){return-257&t},t.offset=function(t){return t>>>10<<((512&t)>>>6)},t.label=function(t){return-2147483393&t}}(r||(r={}))},357:(t,e,r)=>{const s=r(767),i=r(699),o=r(170),n=r(520),a=(r(534),r(105)),h=r(153);function f(t){let e=new DataView(t),r=e.getUint32(0,!0),o=new Uint32Array(t,4,r),a=4+4*r,h=2*e.getUint32(a,!0),f=new Uint8Array(t,a+4,h);return new n.ByteCompletionDawg(new s.Dictionary(o),new i.Guide(f))}e.KA=f,e.Lk=function(t,e,r=1,s=!1){let i=new o.ByteMapDawg(f(t),r,s);return new a.MapDawg(i,h.encodeUtf8,e)}},699:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Guide=class{constructor(t){this.units=t}child(t){return this.units[2*t]}sibling(t){return this.units[2*t+1]}}},105:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MapDawg=class{constructor(t,e,r){this.dawg=t,this.keyEncoder=e,this.valueDeserializer=r}has(t){return this.dawg.hasBytes(this.keyEncoder(t))}*get(t){for(let e of this.dawg.getBytes(this.keyEncoder(t)))yield this.valueDeserializer(e)}getArray(t){return this.dawg.getBytesArray(this.keyEncoder(t)).map((t=>this.valueDeserializer(t)))}}}},e={};function r(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,r),o.exports}r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var s={};(()=>{r.d(s,{SN:()=>h,aq:()=>f,eV:()=>l});var t=r(357),e=r(153);class i{constructor(e,r){this.format=r,"words"===r&&(this.dawgjs_map=(0,t.Lk)(e,this.deserializerWord,1,!0)),"probs"===r&&(this.dawgjs_map=(0,t.Lk)(e,this.deserializerProbs,1,!0)),"int"===r&&(this.dawgjs_byte=(0,t.KA)(e))}findAll(t,e){return[this.getStr(t),...this.getAllReplaces(t,e).map((t=>this.getStr(t)))].filter(Boolean)}getInt(t){if("probs"===this.format||"words"===this.format||void 0===this.dawgjs_byte)throw new Error("You are trying to access wrong DAWG type.");const r=this.dawgjs_byte.dictionary.followBytes((0,e.encodeUtf8)(t)),s=this.dawgjs_byte.dictionary.hasValue(r),i=this.dawgjs_byte.dictionary.value(r)^1<<31;if(s&&void 0!==i)return i}getStr(t){if("int"===this.format||void 0===this.dawgjs_map)throw new Error("You are trying to access wrong DAWG type.");const e=this.dawgjs_map.getArray(t);if(e.length)return[t,e]}getAllReplaces(t,e){const r=[];if(!e||!e.length)return r;for(let s=0;s<t.length;s++){const i=t[s];e.forEach((([e,o])=>{i===e&&r.push(`${t.slice(0,s)}${o}${t.slice(s+1)}`)}))}return r}deserializerWord(t){let e=new DataView(t.buffer);return[e.getUint16(0),e.getUint16(2)]}deserializerProbs(t){let e=new DataView(t.buffer);return[e.getUint16(0),e.getUint16(2),e.getUint16(4)]}}class o{constructor(t,e){let r;const s=e.split(" ");if(2===s.length?(this.stat=s[0].split(","),this.flex=s[1].split(",")):(this.stat=s[0].split(","),this.flex=[]),void 0===this.stat||void 0===this.flex)throw new Error(`Invalid input format: ${s} has ${this.stat} or ${this.flex} undefined`);for(const e of["stat","flex"]){const s=this[e];for(let e=0;e<s.length;e++){let i=s[e];if(t[i])for(this[i]=!0;t[i]&&(r=t[i].parent);)this[r]=i,i=r}}this.POS=this.ud_dict().PoS}toString(){return(this.stat.join(",")+" "+this.flex.join(",")).trim()}matches(t,e){if(!e){if(Array.isArray(t)){for(let e=0;e<t.length;e++)if(!this[t[e]])return!1;return!0}for(let e in t)if(void 0!==t[e])if(Array.isArray(t[e])){if(-1===t[e].indexOf(this[e]))return!1}else if(t[e]!==this[e])return!1;return!0}for(let r=0;r<e.length;r++){let s=e[r];if(t[s]!==this[s])return!1}return!0}ud_dict(){const t={},e=(this.stat+","+this.flex).split(","),r=new Set(["NOUN","NPRO","VERB","ADJF","PRTF","ADVB","GRND","PREP","PRED","Prnt","CONJ","PRCL","INTJ","NUMR","PRCL","Apro","ADJS","COMP","VERB","INFN","PRTS"]),s=new Set(["nomn","gent","datv","accs","ablt","inst","loct","voct","loc2","gen2"]),i=new Set(["1per","2per","3per","0per"]),o=new Set(["masc","neut","femn"]),n=(new Set(["past","futr","imperfect","cond","pres"]),new Set(["impr"]),new Set(["perf","impf"]));for(const a of e)r.has(a)&&(t.PoS=a,"VERB"==a&&(t.VerbForm="Fin"),"INFN"==a&&(t.VerbForm="Inf",t.PoS="VERB")),s.has(a)&&(t.Case=a),n.has(a)&&(t.Aspect=a),"inan"!==a&&"anim"!==a||(t.Animacy=a),"plur"!==a&&"sing"!==a||(t.Number=a),i.has(a)&&(t.Person=a),o.has(a)&&(t.Gender=a);return t}isProductive(){return!new Set(["NUMR","NPRO","PRED","PREP","CONJ","PRCL","INTJ","Apro","NUMB","ROMN","LATN","PNCT","UNKN"]).has(this.POS)}isCapitalized(){return this.Name||this.Surn||this.Patr||this.Geox||this.Init}}const n={ignoreCase:!0,parsers:["Dictionary?","PrefixKnown","PrefixUnknown?","SuffixKnown?"],forceParse:!1,normalizeScore:!0};class a{constructor(t,e,r,s,i,o,n="",a=""){this.prefix="",this.suffix="",this.parser="None",this.score=1,this.tags=e,this.prefixes=r,this.suffixes=s,this.word=i,this.paradigm=t,this.formIdx=o,this.formCnt=this.paradigm.length/3,this.tag=this.tags[this.paradigm[this.formCnt+o]],this.prefix=n||"",this.suffix=a||""}getPref(t){const e=this.paradigm[(this.formCnt<<1)+t];if(void 0===e)throw new Error("Non-existing form");return this.prefixes[e]}getSuf(t){const e=this.paradigm[t];if(void 0===e)throw new Error("Non-existing form");return this.suffixes[e]}base(){return this._base||(this._base=this.word.substring(this.getPref(this.formIdx).length,this.word.length-this.getSuf(this.formIdx).length)),this._base}inflect(t,e){if(!e&&"number"==typeof t){const e="PrefixUnknown"==this.parser?this.prefix:this.getPref(t);return new a(this.paradigm,this.tags,this.prefixes,this.suffixes,e+this.base()+this.getSuf(t),t,this.prefix,this.suffix)}for(let r=0;r<this.formCnt;r++){const s=this.paradigm[this.formCnt+r];if(void 0===s)throw new Error("Non-existing form");const i="PrefixUnknown"==this.parser?this.prefix:this.getPref(r);if(this.tags[s].matches(t,e))return new a(this.paradigm,this.tags,this.prefixes,this.suffixes,i+this.base()+this.getSuf(r),r,this.prefix,this.suffix)}return!1}toString(){if(this.prefix){const t=this.getPref(this.formIdx);return t+this.prefix+this.word.substr(t.length)+this.suffix}return this.word+this.suffix}normalize(t){return this.inflect(t?{POS:this.tag.POS}:0)}}class h{constructor(){this.initialized=!1,this.knownPrefixes=[],this.prefixes=[],this.particles=[],this.predictionSuffixes=[],this.grammemes={},this.tags=[],this.config=n,this.suffixes=[],this.paradigms=[],this.parsers={}}init(t){this.knownPrefixes=t["config.json"].knownPrefixes,this.prefixes=t["config.json"].prefixes,this.particles=t["config.json"].particles,this.replacements=t["config.json"].replacements,this.words=new i(t["words.dawg"],"words"),this.predictionSuffixes=new Array(3);for(let e=0;e<3;e++)this.predictionSuffixes[e]=new i(t[`prediction-suffixes-${e}.dawg`],"probs");if(t["p_t_given_w.intdawg"]&&(this.probabilities=new i(t["p_t_given_w.intdawg"],"int")),this.grammemes=(t["grammemes.json"]||[]).reduce(((t,[e,r,s,i])=>{if(void 0===e||void 0===r||void 0===s||void 0===i)throw new Error("Grammeme file is corrupted: Missing or empty values.");const o={internal:e,parent:r,external:s,externalFull:i};return Object.assign(Object.assign({},t),{[e]:o,[s]:o})}),{}),this.tags=t["gramtab-opencorpora-int.json"].map((t=>new o(this.grammemes,t))),t["gramtab-opencorpora-ext.json"]){let e=t["gramtab-opencorpora-ext.json"].map((t=>new o(this.grammemes,t)));this.tags.forEach(((t,r)=>{r<e.length&&(t.ext=e[r])}))}this.suffixes=t["suffixes.json"];const e=new Uint16Array(t["paradigms.array"]),r=e[0];if(void 0===r)throw new Error("Paradigms array is corrupted: Missing count value.");let s=1;for(let t=0;t<r;t++){const t=e[s++];if(void 0===t)throw new Error("Paradigms array is corrupted: Missing size value.");this.paradigms.push(e.subarray(s,s+t)),s+=t}return this.parsers=function(t,e,r,s,i,o,h,f,l){const c={Dictionary:function(o,f){var l=!(f=f?Object.assign(Object.assign({},n),f):n).ignoreCase&&o.length&&o[0].toLocaleLowerCase()!=o[0]&&o.substr(1).toLocaleUpperCase()!=o.substr(1);o=o.toLocaleLowerCase();var c=t.findAll(o,h),u=[];for(var g of c)for(var d of g[1]){const t=e[d[0]],o=t.length/3,n={},h={},c={};t.slice(0,o).forEach((t=>{var e;c[t]=null!==(e=i[t])&&void 0!==e?e:""})),t.slice(o,o<<1).forEach((t=>{if(!r[t])throw new Error(`Tag not found for key ${t}`);n[t]=r[t]})),t.slice(o<<1,3*o).forEach((t=>{var e;h[t]=null!==(e=s[t])&&void 0!==e?e:""}));var p=new a(t,n,h,c,g[0],d[1]);(f.ignoreCase||!p.tag.isCapitalized()||l)&&u.push(p)}return u},PrefixKnown:function(t,e){var r=!(e=e?Object.assign(Object.assign({},n),e):n).ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();var s=[];for(const o of l)if(!(t.length-o.length<3)&&t.substr(0,o.length)==o){var i=t.substr(o.length);const n=c.Dictionary(i,e);for(const t of n)t.tag&&t.tag.isProductive()&&(e.ignoreCase||!t.tag.isCapitalized()||r)&&(t.score*=.7,t.prefix=o,s.push(t))}return s},PrefixUnknown:function(t,e){var r=!(e=e?Object.assign(Object.assign({},n),e):n).ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();for(var s=[],i=1;i<=5&&!(t.length-i<3);i++){var o=t.substr(i);const n=c.Dictionary(o,e);for(const o of n)o.tag&&o.tag.isProductive()&&(e.ignoreCase||!o.tag.isCapitalized()||r)&&(o.score*=.3,o.prefix=t.substr(0,i),s.push(o))}return s},SuffixKnown:function(t,f){if(f=f?Object.assign(Object.assign({},n),f):n,t.length<4)return[];var l=!f.ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();var c=[],u=1,g=[0,.2,.3,.4,.5,.6];const d={};for(var p=0;p<s.length;p++)if(!s[p].length||t.substr(0,s[p].length)==s[p])for(var w=t.substr(s[p].length),y=5;y>=u;y--)if(!(y>=w.length)){var m=w.substr(0,w.length-y),b=w.substr(w.length-y),x=o[p].findAll(b,h);if(x){var v=[],P=1;for(const t of x){const o=t[0],n=t[1];for(const t of n){if(t.length<3)throw new Error("Corrupted data!");const n=e[t[1]],h=n.length/3,c={},u={},w={};n.slice(0,h).forEach((t=>{var e;w[t]=null!==(e=i[t])&&void 0!==e?e:""})),n.slice(h,h<<1).forEach((t=>{if(!r[t])throw new Error(`Tag not found for key ${t}`);c[t]=r[t]})),n.slice(h<<1,3*h).forEach((t=>{var e;u[t]=null!==(e=s[t])&&void 0!==e?e:""}));var C=new a(n,c,u,w,s[p]+m+o,t[2]);if(!C.tag||!C.tag.isProductive())continue;if(!f.ignoreCase&&C.tag.isCapitalized()&&!l)continue;const b=C.toString()+":"+t[1]+":"+t[2];b in d||(P=Math.max(P,t[0]),C.score=t[0]*g[y],v.push(C),d[b]=!0)}}if(v.length>0){for(let t of v)t.score/=P;c.push(...v),u=Math.max(y-1,1)}}}return c}};return c}(this.words,this.paradigms,this.tags,this.prefixes,this.suffixes,this.predictionSuffixes,this.replacements,this.particles,this.knownPrefixes),this.initialized=!0,this}morph(t,e){var r;if(!this.initialized)throw new Error("Please call Az.Morph.init() before using this module.");this.config=e?Object.assign(Object.assign({},n),e):n;const s=[];let i=!1;for(const e of this.config.parsers){const r="?"!==e[e.length-1],o=r?e:e.slice(0,-1),n=this.parsers[o];if(!n)throw new Error(`Unknown parser named ${o}!`);{const e=n(t,this.config);for(const t of e)t.parser=o,i=!0;if(s.push(...e),i&&r)break}}let o=0;for(const t of s)if("Dictionary"===t.parser){const e=null===(r=this.probabilities)||void 0===r?void 0:r.getInt(`${t}:${t.tag}`);void 0!==e?(t.score=e/1e6,o+=t.score):(t.score=1,o+=t.score)}if(this.config.normalizeScore){if(o>0)for(const t of s)"Dictionary"===t.parser&&(t.score/=o);o=0;for(const t of s)"Dictionary"!==t.parser&&(o+=t.score);if(o>0)for(const t of s)"Dictionary"!==t.parser&&(t.score/=o)}return s.sort(((t,e)=>e.score-t.score)),s}}const f=["grammemes.json","gramtab-opencorpora-int.json","gramtab-opencorpora-ext.json","meta.json","p_t_given_w.intdawg","paradigms.array","prediction-suffixes-0.dawg","prediction-suffixes-1.dawg","prediction-suffixes-2.dawg","prediction-suffixes-3.dawg","suffixes.json","words.dawg","config.json"];function l(t,e){Promise.all(f.map((e=>fetch(`${t}/${e}`).then((t=>t.ok?"json"===e.split(".")[1]?t.json():t.arrayBuffer():null))))).then((t=>{e(f.reduce(((e,r,s)=>Object.assign(Object.assign({},e),{[r]:t[s]})),{}))}))}})();var i=s.SN,o=s.aq,n=s.eV;export{i as AzClass,o as files,n as loadDicts};