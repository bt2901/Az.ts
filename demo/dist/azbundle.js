var t={520:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(301);class i extends r.ByteDawg{constructor(t,e){super(t),this.dictionary=t,this.guide=e}hasBytesWithPrefix(t){return!this.completionsBytes(t).next().done}*completionsBytes(t){let e=this.dictionary.followBytes(t);null!==e&&(yield*function*(t,e,s){let r=new Array,i=[s];for(;i.length;){for(;!t.hasValue(s);){let o=e.child(s);if(null===(s=t.followByte(o,s)))return;r.push(o),i.push(s)}yield r;let o=e.child(s);if(o){if(null===(s=t.followByte(o,s)))return;r.push(o),i.push(s)}else for(;;){if(i.pop(),!i.length)return;r.pop();let o=e.sibling(s);if(s=i[i.length-1],o){if(null===(s=t.followByte(o,s)))return;r.push(o),i.push(s);break}}}}(this.dictionary,this.guide,e))}completionsBytesArray(t){let e=this.dictionary.followBytes(t);return null===e?[]:function(t,e,s){let r=new Array,i=new Array,o=[s];for(;o.length;){for(;!t.hasValue(s);){let n=e.child(s);if(null===(s=t.followByte(n,s)))return r;i.push(n),o.push(s)}r.push([...i]);let n=e.child(s);if(n){if(null===(s=t.followByte(n,s)))return r;i.push(n),o.push(s)}else for(;;){if(o.pop(),!o.length)return r;i.pop();let n=e.sibling(s);if(s=o[o.length-1],n){if(null===(s=t.followByte(n,s)))return r;i.push(n),o.push(s);break}}}return r}(this.dictionary,this.guide,e)}}e.ByteCompletionDawg=i},301:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ByteDawg=class{constructor(t){this.dictionary=t}hasBytes(t){return this.dictionary.has(t)}}},170:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(153);e.ByteMapDawg=class{constructor(t,e=1,s=!1){this.dawg=t,this.payloadSeparator=e,this.binasciiWorkaround=s}hasBytes(t){return this.dawg.hasBytesWithPrefix([...t,this.payloadSeparator])}*getBytes(t){for(let e of this.dawg.completionsBytes([...t,this.payloadSeparator]))this.binasciiWorkaround&&(e=e.slice(0,-1)),yield r.b64decodeFromArray(e)}getBytesArray(t){let e=new Array,s=this.dawg.completionsBytesArray([...t,this.payloadSeparator]);for(let t=0;t<s.length;++t){let i=s[t];this.binasciiWorkaround&&(i=i.slice(0,-1)),e.push(r.b64decodeFromArray(i))}return e}}},153:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.encodeUtf8=function(t){let e=new Array;for(let s=0;s<t.length;++s){let r=t.charCodeAt(s);r<128?e.push(r):r<2048?(e.push(r>>>6|192),e.push(63&r|128)):(e.push(r>>>12|224),e.push(r>>>6&63|128),e.push(63&r|128))}return e},e.decodeUtf8=function(t){let e="";for(let s=0;s<t.length;++s){let r=t[s];if(r<128)e+=String.fromCharCode(r);else if(r>191&&r<224){let i=t[++s];e+=String.fromCharCode((31&r)<<6|63&i)}else{let i=t[++s],o=t[++s];e+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return e};const s=[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].map((t=>t.codePointAt(0))),r="+".charCodeAt(0),i="/".charCodeAt(0),o="0".charCodeAt(0),n="a".charCodeAt(0),a="A".charCodeAt(0),h="-".charCodeAt(0),f="_".charCodeAt(0),l="=".charCodeAt(0);function u(t){if(t===r||t===h)return 62;if(t===i||t===f)return 63;if(t<o+10)return t-o+26+26;if(t<a+26)return t-a;if(t<n+26)return t-n+26;if(t<o)throw""}e.b64decodeFromArray=function(t){let e,s=t.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");e=t[s-2]===l?2:t[s-1]===l?1:0;let r=new Uint8Array(3*s/4-e),i=0,o=e>0?s-4:s,n=0;for(let e=0;n<o;n+=4,e+=3){let e=u(t[n])<<18|u(t[n+1])<<12|u(t[n+2])<<6|u(t[n+3]);r[i++]=(16711680&e)>>16,r[i++]=(65280&e)>>8,r[i++]=255&e}if(2===e){let e=u(t[n])<<2|u(t[n+1])>>4;r[i++]=255&e}else if(1===e){let e=u(t[n])<<10|u(t[n+1])<<4|u(t[n+2])>>2;r[i++]=e>>8&255,r[i++]=255&e}return r},e.b64encode=function(t){let e,r=new Array,i=0;for(let o=0;o<t.length/3;++o)e=t[i++]<<16,e+=t[i++]<<8,e+=t[i++],r.push(s[(16515072&e)>>18]),r.push(s[(258048&e)>>12]),r.push(s[(4032&e)>>6]),r.push(s[63&e]);switch(t.length%3){case 1:e=t[i++]<<16,r.push(s[(16515072&e)>>18]),r.push(s[(258048&e)>>12]),r.push(l,l);break;case 2:e=t[i++]<<16,e+=t[i++]<<8,r.push(s[(16515072&e)>>18]),r.push(s[(258048&e)>>12]),r.push(s[(4032&e)>>6]),r.push(l)}return r}},534:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(290);class i extends r.Dawg{constructor(t,e,s){super(t,e),this.dawg=t,this.keyDecoder=s}hasWithPrefix(t){return this.dawg.hasBytesWithPrefix(this.keyEncoder(t))}*completions(t){for(let e of this.dawg.completionsBytes(this.keyEncoder(t)))yield this.keyDecoder(e)}}e.CompletionDawg=i},290:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Dawg=class{constructor(t,e){this.dawg=t,this.keyEncoder=e}has(t){return this.dawg.hasBytes(this.keyEncoder(t))}}},767:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),e.Dictionary=class{constructor(t){this.units=t}has(t){let e=this.followBytes(t);return null!==e&&s.hasLeaf(this.units[e])}hasValue(t){return s.hasLeaf(this.units[t])}value(t){return s.value(this.units[t^s.offset(this.units[t])])}followBytes(t,e=0){for(let s of t)if(null===(e=this.followByte(s,e)))return null;return e}followByte(t,e){let r=e^s.offset(this.units[e])^t;return s.label(this.units[r])!==t?null:r}},function(t){t.hasLeaf=function(t){return!!(256&t)},t.value=function(t){return-257&t},t.offset=function(t){return t>>>10<<((512&t)>>>6)},t.label=function(t){return-2147483393&t}}(s||(s={}))},357:(t,e,s)=>{const r=s(767),i=s(699),o=s(170),n=s(520),a=(s(534),s(105)),h=s(153);function f(t){let e=new DataView(t),s=e.getUint32(0,!0),o=new Uint32Array(t,4,s),a=4+4*s,h=2*e.getUint32(a,!0),f=new Uint8Array(t,a+4,h);return new n.ByteCompletionDawg(new r.Dictionary(o),new i.Guide(f))}e.KA=f,e.Lk=function(t,e,s=1,r=!1){let i=new o.ByteMapDawg(f(t),s,r);return new a.MapDawg(i,h.encodeUtf8,e)}},699:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Guide=class{constructor(t){this.units=t}child(t){return this.units[2*t]}sibling(t){return this.units[2*t+1]}}},105:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MapDawg=class{constructor(t,e,s){this.dawg=t,this.keyEncoder=e,this.valueDeserializer=s}has(t){return this.dawg.hasBytes(this.keyEncoder(t))}*get(t){for(let e of this.dawg.getBytes(this.keyEncoder(t)))yield this.valueDeserializer(e)}getArray(t){return this.dawg.getBytesArray(this.keyEncoder(t)).map((t=>this.valueDeserializer(t)))}}}},e={};function s(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,s),o.exports}s.d=(t,e)=>{for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r={};(()=>{s.d(r,{SN:()=>h,aq:()=>f,eV:()=>l});var t=s(357),e=s(153);class i{constructor(e,s){this.format=s,"words"===s&&(this.dawgjs_map=(0,t.Lk)(e,this.deserializerWord,1,!0)),"probs"===s&&(this.dawgjs_map=(0,t.Lk)(e,this.deserializerProbs,1,!0)),"int"===s&&(this.dawgjs_byte=(0,t.KA)(e))}findAll(t,e){return[this.getStr(t),...this.getAllReplaces(t,e).map((t=>this.getStr(t)))].filter(Boolean)}getInt(t){if("probs"===this.format||"words"===this.format||void 0===this.dawgjs_byte)throw new Error("You are trying to access wrong DAWG type.");const s=this.dawgjs_byte.dictionary.followBytes((0,e.encodeUtf8)(t)),r=this.dawgjs_byte.dictionary.hasValue(s),i=this.dawgjs_byte.dictionary.value(s)^1<<31;if(r&&void 0!==i)return i}getStr(t){if("int"===this.format||void 0===this.dawgjs_map)throw new Error("You are trying to access wrong DAWG type.");const e=this.dawgjs_map.getArray(t);if(e.length)return[t,e]}getAllReplaces(t,e){const s=[];if(!e||!e.length)return s;for(let r=0;r<t.length;r++){const i=t[r];e.forEach((([e,o])=>{i===e&&s.push(`${t.slice(0,r)}${o}${t.slice(r+1)}`)}))}return s}deserializerWord(t){let e=new DataView(t.buffer);return[e.getUint16(0),e.getUint16(2)]}deserializerProbs(t){let e=new DataView(t.buffer);return[e.getUint16(0),e.getUint16(2),e.getUint16(4)]}}class o{constructor(t,e){let s;const r=e.split(" ");if(2===r.length?(this.stat=r[0].split(","),this.flex=r[1].split(",")):(this.stat=r[0].split(","),this.flex=[]),void 0===this.stat||void 0===this.flex)throw new Error(`Invalid input format: ${r} has ${this.stat} or ${this.flex} undefined`);for(const e of["stat","flex"]){const r=this[e];for(let e=0;e<r.length;e++){let i=r[e];if(t[i])for(this[i]=!0;t[i]&&(s=t[i].parent);)this[s]=i,i=s}}this.POS=this.ud_dict().PoS}toString(){return(this.stat.join(",")+" "+this.flex.join(",")).trim()}matches(t,e){if(!e){if(Array.isArray(t)){for(let e=0;e<t.length;e++)if(!this[t[e]])return!1;return!0}for(let e in t)if(void 0!==t[e])if(Array.isArray(t[e])){if(-1===t[e].indexOf(this[e]))return!1}else if(t[e]!==this[e])return!1;return!0}for(let s=0;s<e.length;s++){let r=e[s];if(t[r]!==this[r])return!1}return!0}ud_dict(){const t={},e=(this.stat+","+this.flex).split(","),s=new Set(["NOUN","NPRO","VERB","ADJF","PRTF","ADVB","GRND","PREP","PRED","Prnt","CONJ","PRCL","INTJ","NUMR","PRCL","Apro","ADJS","COMP","VERB","INFN","PRTS"]),r=new Set(["nomn","gent","datv","accs","ablt","inst","loct","voct","loc2","gen2"]),i=new Set(["1per","2per","3per","0per"]),o=new Set(["masc","neut","femn"]),n=(new Set(["past","futr","imperfect","cond","pres"]),new Set(["impr"]),new Set(["perf","impf"]));for(const a of e)s.has(a)&&(t.PoS=a,"VERB"==a&&(t.VerbForm="Fin"),"INFN"==a&&(t.VerbForm="Inf",t.PoS="VERB")),r.has(a)&&(t.Case=a),n.has(a)&&(t.Aspect=a),"inan"!==a&&"anim"!==a||(t.Animacy=a),"plur"!==a&&"sing"!==a||(t.Number=a),i.has(a)&&(t.Person=a),o.has(a)&&(t.Gender=a);return t}isProductive(){return!new Set(["NUMR","NPRO","PRED","PREP","CONJ","PRCL","INTJ","Apro","NUMB","ROMN","LATN","PNCT","UNKN"]).has(this.POS)}isCapitalized(){return this.Name||this.Surn||this.Patr||this.Geox||this.Init}}const n={ignoreCase:!0,parsers:["Dictionary?","PrefixKnown","PrefixUnknown?","SuffixKnown?"],forceParse:!1,normalizeScore:!0};class a{constructor(t,e,s,r,i,o,n,a="",h=""){this.prefix="",this.suffix="",this.parser="None",this.score=1,this.paradigms=t,this.tags=e,this.prefixes=s,this.suffixes=r,this.word=i,this.paradigmIdx=o,this.paradigm=this.paradigms[o],this.formIdx=n,this.formCnt=this.paradigm.length/3,this.tag=this.tags[this.paradigm[this.formCnt+n]],this.prefix=a||"",this.suffix=h||""}getPref(t){const e=this.paradigm[(this.formCnt<<1)+t];if(void 0===e)throw new Error("Non-existing form");return this.prefixes[e]}getSuf(t){const e=this.paradigm[t];if(void 0===e)throw new Error("Non-existing form");return this.suffixes[e]}base(){return this._base||(this._base=this.word.substring(this.getPref(this.formIdx).length,this.word.length-this.getSuf(this.formIdx).length)),this._base}inflect(t,e){if(!e&&"number"==typeof t)return new a(this.paradigms,this.tags,this.prefixes,this.suffixes,this.getPref(t)+this.base()+this.getSuf(t),this.paradigmIdx,t,this.prefix,this.suffix);for(let s=0;s<this.formCnt;s++){const r=this.paradigm[this.formCnt+s];if(void 0===r)throw new Error("Non-existing form");if(this.tags[r].matches(t,e))return new a(this.paradigms,this.tags,this.prefixes,this.suffixes,this.getPref(s)+this.base()+this.getSuf(s),this.paradigmIdx,s,this.prefix,this.suffix)}return!1}toString(){if(this.prefix){const t=this.getPref(this.formIdx);return t+this.prefix+this.word.substr(t.length)+this.suffix}return this.word+this.suffix}normalize(t){return this.inflect(t?{POS:this.tag.POS}:0)}}class h{constructor(){this.initialized=!1,this.knownPrefixes=[],this.prefixes=[],this.particles=[],this.predictionSuffixes=[],this.grammemes={},this.tags=[],this.config=n,this.suffixes=[],this.paradigms=[],this.parsers={}}init(t){this.knownPrefixes=t["config.json"].knownPrefixes,this.prefixes=t["config.json"].prefixes,this.particles=t["config.json"].particles,this.replacements=t["config.json"].replacements,this.words=new i(t["words.dawg"],"words"),this.predictionSuffixes=new Array(3);for(let e=0;e<3;e++)this.predictionSuffixes[e]=new i(t[`prediction-suffixes-${e}.dawg`],"probs");if(t["p_t_given_w.intdawg"]&&(this.probabilities=new i(t["p_t_given_w.intdawg"],"int")),this.grammemes=(t["grammemes.json"]||[]).reduce(((t,[e,s,r,i])=>{if(void 0===e||void 0===s||void 0===r||void 0===i)throw new Error("Grammeme file is corrupted: Missing or empty values.");const o={internal:e,parent:s,external:r,externalFull:i};return Object.assign(Object.assign({},t),{[e]:o,[r]:o})}),{}),this.tags=t["gramtab-opencorpora-int.json"].map((t=>new o(this.grammemes,t))),t["gramtab-opencorpora-ext.json"]){let e=t["gramtab-opencorpora-ext.json"].map((t=>new o(this.grammemes,t)));this.tags.forEach(((t,s)=>{s<e.length&&(t.ext=e[s])}))}this.suffixes=t["suffixes.json"];const e=new Uint16Array(t["paradigms.array"]),s=e[0];if(void 0===s)throw new Error("Paradigms array is corrupted: Missing count value.");let r=1;for(let t=0;t<s;t++){const t=e[r++];if(void 0===t)throw new Error("Paradigms array is corrupted: Missing size value.");this.paradigms.push(e.subarray(r,r+t)),r+=t}return this.parsers=function(t,e,s,r,i,o,h,f,l){const u={Dictionary:function(o,f){var l=!(f=f?Object.assign(Object.assign({},n),f):n).ignoreCase&&o.length&&o[0].toLocaleLowerCase()!=o[0]&&o.substr(1).toLocaleUpperCase()!=o.substr(1);o=o.toLocaleLowerCase();var u=t.findAll(o,h),c=[];for(var g of u)for(var d of g[1]){var p=new a(e,s,r,i,g[0],d[0],d[1]);(f.ignoreCase||!p.tag.isCapitalized()||l)&&c.push(p)}return c},PrefixKnown:function(t,e){var s=!(e=e?Object.assign(Object.assign({},n),e):n).ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();var r=[];for(const o of l)if(!(t.length-o.length<3)&&t.substr(0,o.length)==o){var i=t.substr(o.length);const n=u.Dictionary(i,e);for(const t of n)t.tag&&t.tag.isProductive()&&(e.ignoreCase||!t.tag.isCapitalized()||s)&&(t.score*=.7,t.prefix=o,r.push(t))}return r},PrefixUnknown:function(t,e){var s=!(e=e?Object.assign(Object.assign({},n),e):n).ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();for(var r=[],i=1;i<=5&&!(t.length-i<3);i++){var o=t.substr(i);const n=u.Dictionary(o,e);for(const o of n)o.tag&&o.tag.isProductive()&&(e.ignoreCase||!o.tag.isCapitalized()||s)&&(o.score*=.3,o.prefix=t.substr(0,i),r.push(o))}return r},SuffixKnown:function(t,f){if(f=f?Object.assign(Object.assign({},n),f):n,t.length<4)return[];var l=!f.ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();var u=[],c=1,g=[0,.2,.3,.4,.5,.6];const d={};for(var p=0;p<r.length;p++)if(!r[p].length||t.substr(0,r[p].length)==r[p])for(var w=t.substr(r[p].length),y=5;y>=c;y--)if(!(y>=w.length)){var m=w.substr(0,w.length-y),b=w.substr(w.length-y),x=o[p].findAll(b,h);if(x){var v=[],P=1;for(const t of x){const o=t[0],n=t[1];for(const t of n){if(t.length<3)throw new Error("Corrupted data!");var C=new a(e,s,r,i,r[p]+m+o,t[1],t[2]);if(!C.tag||!C.tag.isProductive())continue;if(!f.ignoreCase&&C.tag.isCapitalized()&&!l)continue;const n=C.toString()+":"+t[1]+":"+t[2];n in d||(P=Math.max(P,t[0]),C.score=t[0]*g[y],v.push(C),d[n]=!0)}}if(v.length>0){for(let t of v)t.score/=P;u.push(...v),c=Math.max(y-1,1)}}}return u}};return u}(this.words,this.paradigms,this.tags,this.prefixes,this.suffixes,this.predictionSuffixes,this.replacements,this.particles,this.knownPrefixes),this.initialized=!0,this}morph(t,e){var s;if(!this.initialized)throw new Error("Please call Az.Morph.init() before using this module.");this.config=e?Object.assign(Object.assign({},n),e):n;const r=[];let i=!1;for(const e of this.config.parsers){const s="?"!==e[e.length-1],o=s?e:e.slice(0,-1),n=this.parsers[o];if(!n)throw new Error(`Unknown parser named ${o}!`);{const e=n(t,this.config);for(const t of e)t.parser=o,i=!0;if(r.push(...e),i&&s)break}}let o=0;for(const t of r)if("Dictionary"===t.parser){const e=null===(s=this.probabilities)||void 0===s?void 0:s.getInt(`${t}:${t.tag}`);void 0!==e?(t.score=e/1e6,o+=t.score):(t.score=1,o+=t.score)}if(this.config.normalizeScore){if(o>0)for(const t of r)"Dictionary"===t.parser&&(t.score/=o);o=0;for(const t of r)"Dictionary"!==t.parser&&(o+=t.score);if(o>0)for(const t of r)"Dictionary"!==t.parser&&(t.score/=o)}return r.sort(((t,e)=>e.score-t.score)),r}}const f=["grammemes.json","gramtab-opencorpora-int.json","gramtab-opencorpora-ext.json","meta.json","p_t_given_w.intdawg","paradigms.array","prediction-suffixes-0.dawg","prediction-suffixes-1.dawg","prediction-suffixes-2.dawg","prediction-suffixes-3.dawg","suffixes.json","words.dawg","config.json"];function l(t,e){Promise.all(f.map((e=>fetch(`${t}/${e}`).then((t=>t.ok?"json"===e.split(".")[1]?t.json():t.arrayBuffer():null))))).then((t=>{e(f.reduce(((e,s,r)=>Object.assign(Object.assign({},e),{[s]:t[r]})),{}))}))}})();var i=r.SN,o=r.aq,n=r.eV;export{i as AzClass,o as files,n as loadDicts};