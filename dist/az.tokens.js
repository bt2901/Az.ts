import{Az}from"./az";let TLDs="ac|ad|ae|aero|af|ag|ai|al|am|ao|aq|ar|arpa|as|asia|at|au|aw|ax|az|ba|bb|be|bf|bg|bh|bi|biz|bj|bm|bo|br|bs|bt|bv|bw|by|bz|ca|cat|cc|cd|cf|cg|ch|ci|cl|cm|cn|co|com|coop|cr|cu|cv|cw|cx|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|es|et|eu|fi|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|info|int|io|iq|ir|is|it|je|jo|jobs|jp|kg|ki|km|kn|kp|kr|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mn|mo|mobi|mp|mq|mr|ms|mt|mu|museum|mv|mw|mx|my|na|name|nc|ne|net|nf|ng|nl|no|nr|nu|nz|om|org|pa|pe|pf|ph|pk|pl|pm|pn|post|pr|pro|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tr|travel|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|yt|امارات|հայ|বাংলা|бел|中国|中國|الجزائر|مصر|ею|გე|ελ|香港|भारत|بھارت|భారత్|ભારત|ਭਾਰਤ|ভারত|இந்தியா|ایران|ايران|عراق|الاردن|한국|қаз|ලංකා|இலங்கை|المغرب|мкд|мон|澳門|澳门|مليسيا|عمان|پاکستان|پاكستان|فلسطين|срб|рф|قطر|السعودية|السعودیة|السعودیۃ|السعوديه|سودان|新加坡|சிங்கப்பூர்|سورية|سوريا|ไทย|تونس|台灣|台湾|臺灣|укр|اليمن|xxx|zm|aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|academy|accenture|accountant|accountants|aco|active|actor|adac|ads|adult|aeg|aetna|afamilycompany|afl|africa|africamagic|agakhan|agency|aig|aigo|airbus|airforce|airtel|akdn|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|aol|apartments|app|apple|aquarelle|arab|aramco|archi|army|art|arte|asda|associates|athleta|attorney|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aws|axa|azure|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bbc|bbt|bbva|bcg|bcn|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bharti|bible|bid|bike|bing|bingo|bio|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bms|bmw|bnl|bnpparibas|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|bradesco|bridgestone|broadway|broker|brother|brussels|budapest|bugatti|build|builders|business|buy|buzz|bzh|cab|cafe|cal|call|calvinklein|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|catering|catholic|cba|cbn|cbre|cbs|ceb|center|ceo|cern|cfa|cfd|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|coach|codes|coffee|college|cologne|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|corsica|country|coupon|coupons|courses|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cuisinella|cymru|cyou|dabur|dad|dance|date|dating|datsun|day|dclk|dds|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dnp|docs|dodge|dog|doha|domains|dot|download|drive|dstv|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dwg|earth|eat|edeka|education|email|emerck|emerson|energy|engineer|engineering|enterprises|epost|epson|equipment|ericsson|erni|esq|estate|esurance|etisalat|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|flickr|flights|flir|florist|flowers|flsmidth|fly|foo|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|gal|gallery|gallo|gallup|game|games|gap|garden|gbiz|gdn|gea|gent|genting|george|ggee|gift|gifts|gives|giving|glade|glass|gle|global|globo|gmail|gmbh|gmo|gmx|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gotv|grainger|graphics|gratis|green|gripe|group|guardian|gucci|guge|guide|guitars|guru|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hkt|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|host|hosting|hot|hoteles|hotmail|house|how|hsbc|htc|hughes|hyatt|hyundai|ibm|icbc|ice|icu|ieee|ifm|iinet|ikano|imamat|imdb|immo|immobilien|industries|infiniti|ing|ink|institute|insurance|insure|intel|international|intuit|investments|ipiranga|irish|iselect|ismaili|ist|istanbul|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|jeep|jetzt|jewelry|jio|jlc|jll|jmp|jnj|joburg|jot|joy|jpmorgan|jprs|juegos|juniper|kaufen|kddi|kerryhotels|kerrylogistics|kerryproperties|kfh|kia|kim|kinder|kindle|kitchen|kiwi|koeln|komatsu|kosher|kpmg|kpn|krd|kred|kuokgroup|kyknet|kyoto|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|ltd|ltda|lundbeck|lupin|luxe|luxury|macys|madrid|maif|maison|makeup|man|management|mango|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mcd|mcdonalds|mckinsey|med|media|meet|melbourne|meme|memorial|men|menu|meo|metlife|miami|microsoft|mini|mint|mit|mitsubishi|mlb|mls|mma|mnet|mobily|moda|moe|moi|mom|monash|money|monster|montblanc|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|msd|mtn|mtpc|mtr|multichoice|mutual|mutuelle|mzansimagic|nab|nadex|nagoya|naspers|nationwide|natura|navy|nba|nec|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nfl|ngo|nhk|nico|nike|nikon|ninja|nissan|nissay|nokia|northwesternmutual|norton|now|nowruz|nowtv|nra|nrw|ntt|nyc|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|organic|orientexpress|origins|osaka|otsuka|ott|ovh|page|pamperedchef|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|payu|pccw|pet|pfizer|pharmacy|philips|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|place|play|playstation|plumbing|plus|pnc|pohl|poker|politie|porn|pramerica|praxi|press|prime|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|pub|pwc|qpon|quebec|quest|qvc|racing|raid|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|rocher|rocks|rodeo|rogers|room|rsvp|ruhr|run|rwe|ryukyu|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sbi|sbs|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shopping|shouji|show|showtime|shriram|silk|sina|singles|site|ski|skin|sky|skype|sling|smart|smile|sncf|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|srl|srt|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|sucks|supersport|supplies|supply|support|surf|surgery|suzuki|swatch|swiftcover|swiss|sydney|symantec|systems|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tci|tdk|team|tech|technology|telecity|telefonica|temasek|tennis|teva|thd|theater|theatre|theguardian|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tjmaxx|tjx|tkmaxx|tmall|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|trade|trading|training|travelchannel|travelers|travelersinsurance|trust|trv|tube|tui|tunes|tushu|tvs|ubank|ubs|uconnect|unicom|university|uno|uol|ups|vacations|vana|vanguard|vegas|ventures|verisign|versicherung|vet|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vodka|volkswagen|volvo|vote|voting|voto|voyage|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|कॉम|セール|佛山|慈善|集团|在线|大众汽车|点看|คอม|八卦|موقع|一号店|公益|公司|香格里拉|网站|移动|我爱你|москва|католик|онлайн|сайт|联通|קום|时尚|微博|淡马锡|ファッション|орг|नेट|ストア|삼성|商标|商店|商城|дети|ポイント|新闻|工行|家電|كوم|中文网|中信|娱乐|谷歌|電訊盈科|购物|クラウド|通販|网店|संगठन|餐厅|网络|ком|诺基亚|食品|飞利浦|手表|手机|ارامكو|العليان|اتصالات|بازار|موبايلي|ابوظبي|كاثوليك|همراه|닷컴|政府|شبكة|بيتك|عرب|机构|组织机构|健康|рус|珠宝|大拿|みんな|グーグル|世界|書籍|网址|닷넷|コム|天主教|游戏|vermögensberater|vermögensberatung|企业|信息|嘉里大酒店|嘉里|广东|政务|xperia|xyz|yachts|yahoo|yamaxun|yandex|yodobashi|yoga|yokohama|you|youtube|yun|zappos|zara|zero|zip|zippo|zone|zuerich".split("|"),defaults_tokens={html:!1,wiki:!1,markdown:!1,hashtags:!0,mentions:!0,emails:!0,links:{protocols:!0,www:!1,tlds:{}}},HTML_ENTITIES={nbsp:" ",quot:'"',gt:">",lt:"<",amp:"&",ndash:"–"};for(let e=0;e<TLDs.length;e++)defaults_tokens.links.tlds[TLDs[e]]=!0;class Token{constructor(e,t,s,n,o,a,i,r){this.source=e,this.st=t,this.length=s,this.index=n,this.firstUpper=o,this.allUpper=a,this.type=i,this.subType=r,this.quote="",this._str="",r&&(this.subType=r)}toString(){return"_str"in this&&this._str.length==this.length?this._str:this._str=this.source.substr(this.st,this.length)}indexOf(e){if(1==e.length){for(let t=0;t<this.length;t++)if(this.source[this.st+t]==e)return t;return-1}return this.toString().indexOf(e)}toLowerCase(){return this.toString().toLocaleLowerCase()}isCapitalized(){return this.firstUpper&&!this.allUpper}en(){return this.st+this.length-1}}class Tokens{constructor(e,t){if(this.text=e,this.config=t,!(this instanceof Tokens))return new Tokens(e,t);this.tokens=[],this.source="","string"==typeof e?(this.config=t?Az.extend(defaults_tokens,t):defaults_tokens,this.append(e)):this.config=e?Az.extend(defaults_tokens,e):defaults_tokens,this.index=-1}append(e,t){var s,n;(t=t?Az.extend(this.config,t):this.config).links&&!0===t.links.tlds&&(t.links.tlds=defaults_tokens.links.tlds);let o=null===(s=this.source)||void 0===s?void 0:s.length;this.source+=e;let a=this.source,i=this.tokens;for(let e=o;e<a.length;e++){let s=a[e],o=a.charCodeAt(e),r=!1,l=i.length-1,c=i[l],h=e;if(t.html&&";"==s)if(l>0&&c.type===Tokens.WORD&&1==(null===(n=i[l-1])||void 0===n?void 0:n.length)&&"&"==a[i[l-1].st]){let e=c.toLowerCase();e in HTML_ENTITIES&&(s=HTML_ENTITIES[e],o=s.charCodeAt(0),l-=2,c=i[l],i.length=l+1)}else l>1&&(c.type===Tokens.NUMBER||c.type===Tokens.WORD&&"x"==a[c.st])&&1==i[l-1].length&&"#"==a[i[l-1].st]&&1==i[l-1].length&&"&"==a[i[l-1].st]&&(o="x"==a[c.st]?parseInt(c.toString().substr(1),16):parseInt(c.toString(),10),s=String.fromCharCode(o),l-=3,c=i[l],i.length=l+1);let p=Tokens.OTHER,k=s.toLocaleLowerCase()!=s;o>=1024&&o<=1279&&(p=Tokens.CYRIL),(o>=65&&o<=90||o>=97&&o<=122||o>=192&&o<=591)&&(p=Tokens.LATIN),o>=48&&o<=57&&(p=Tokens.DIGIT),(o<=32||o>=128&&o<=160)&&(p=Tokens.SPACE),"‐-−‒–—―.…,:;?!¿¡()[]«»\"'’‘’“”/⁄".indexOf(s)>-1&&(p=Tokens.PUNCT);let g=p,u=!1;p===Tokens.CYRIL||p===Tokens.LATIN?(g=Tokens.WORD,u=p):p===Tokens.DIGIT&&(g=Tokens.NUMBER);let d=!c||"\n"==a[c.st+c.length-1];if(t.wiki&&(d&&":;*#~|".indexOf(s)>-1&&(g=Tokens.MARKUP,u=Tokens.NEWLINE),"={[|]}".indexOf(s)>-1&&(g=Tokens.MARKUP)),t.markdown&&(d&&"=-#>+-".indexOf(s)>-1&&(g=Tokens.MARKUP,u=Tokens.NEWLINE),"[]*~_`\\".indexOf(s)>-1&&(g=Tokens.MARKUP)),c)if(t.wiki&&"'"!=s&&1==c.length&&"'"==a[c.st]&&l>0&&i[l-1].type===Tokens.WORD&&i[l-1].subType===Tokens.LATIN&&(i[l-1].length+=c.length,l-=1,i.length=l+1,c=i[l]),t.links&&t.links.tlds&&(p===Tokens.PUNCT||p===Tokens.SPACE)&&i.length>2&&i[l-2].type===Tokens.WORD&&1==i[l-1].length&&"."==a[i[l-1].st]&&i[l].type===Tokens.WORD&&c.toString()in t.links.tlds){for(;l>=2&&i[l-2].type===Tokens.WORD&&1==i[l-1].length&&("."==a[i[l-1].st]||"@"==a[i[l-1].st]||":"==a[i[l-1].st]);)l-=2,c=i[l],c.length+=i[l+1].length+i[l+2].length,c.allUpper=c.allUpper&&i[l+1].allUpper&&i[l+2].allUpper;t.emails&&c.indexOf("@")>-1&&-1==c.indexOf(":")?c.type=Tokens.EMAIL:(c.type=Tokens.LINK,"/"==s&&(r=!0)),i.length=l+1}else if(c.type===Tokens.LINK)")"==s&&l>=1&&i[l-1].type===Tokens.MARKUP&&1==i[l-1].length&&"("==a[i[l-1].st]?g=Tokens.MARKUP:p!==Tokens.SPACE&&","!=s&&"<"!=s&&(r=!0);else if(c.type===Tokens.EMAIL)p!==Tokens.CYRIL&&p!==Tokens.LATIN&&"."!=s||(r=!0);else if(c.type===Tokens.HASHTAG||c.type===Tokens.MENTION)(p===Tokens.CYRIL||p==Tokens.LATIN||p==Tokens.DIGIT||"_"==s||"@"==s&&-1==c.indexOf("@"))&&(r=!0);else if(c.type!==Tokens.TAG||!c.quote&&">"==a[c.en()])if(c.type===Tokens.CONTENT)r=!0,c.quote?s==c.quote&&"\\"!=a[c.en()]&&delete c.quote:'"'==s||"'"==s?c.quote=s:">"==s&&(c.length>=8&&"</script"==c.toString().substr(-8)?(c.length-=8,h-=8,r=!1,g=Tokens.TAG,u=Tokens.CLOSING):c.length>=7&&"</style"==c.toString().substr(-7)&&(c.length-=7,h-=7,r=!1,g=Tokens.TAG,u=Tokens.CLOSING));else if(c.type===Tokens.TAG&&c.type!==Tokens.CLOSING&&c.length>=8&&"script"==c.toLowerCase().substr(1,6))g=Tokens.CONTENT,u=Tokens.SCRIPT;else if(c.type===Tokens.TAG&&c.type!==Tokens.CLOSING&&c.length>=7&&"style"==c.toLowerCase().substr(1,5))g=Tokens.CONTENT,u=Tokens.STYLE;else if(!t.html||1!=c.length||"<"!=a[c.st]||p!==Tokens.LATIN&&"!"!=s&&"/"!=s)if(c.type===Tokens.CONTENT)r=!0;else if(c.type!==Tokens.MARKUP||c.subType!=Tokens.TEMPLATE||"}"==a[c.en()]&&"}"==a[c.en()-1]){if(c.type===Tokens.MARKUP&&c.type===Tokens.LINK&&")"!=a[c.en()])r=!0;else if(c.type===Tokens.MARKUP&&"`"==a[c.st]&&c.subType===Tokens.NEWLINE&&p===Tokens.LATIN)r=!0;else if(p===Tokens.CYRIL||p===Tokens.LATIN)c.type===Tokens.WORD?(r=!0,c.subType=c.subType==p?c.subType:Tokens.MIXED):c.type===Tokens.NUMBER?(r=!0,c.subType=c.subType&&c.subType!=p?Tokens.MIXED:p):t.hashtags&&1==c.length&&"#"==a[c.st]?(r=!0,c.type=Tokens.HASHTAG):!t.mentions||1!=c.length||"@"!=a[c.st]||0!=l&&i[l-1].type!==Tokens.SPACE?p!==Tokens.LATIN||1!=c.length||"'"!=a[c.st]&&"’"!=a[c.st]?1==c.length&&"-"==a[c.st]&&(r=!0,l>0&&i[l-1].type===Tokens.NUMBER&&(c=i[l-1],c.length+=i[l].length,i.length-=1),c.type=Tokens.WORD,c.subType=p):(r=!0,c.type=Tokens.WORD,c.subType=Tokens.LATIN):(r=!0,c.type=Tokens.MENTION);else if(p===Tokens.DIGIT)c.type===Tokens.WORD?(r=!0,c.subType=Tokens.MIXED):c.type===Tokens.NUMBER?r=!0:1!=c.length||"+"!=a[c.st]&&"-"!=a[c.st]?1==c.length&&(","==a[c.st]||"."==a[c.st])&&i.length>1&&i[l-1].type===Tokens.NUMBER&&(r=!0,c=i[l-1],c.length+=i[l].length,i.length-=1):(r=!0,l>0&&i[l-1].type===Tokens.NUMBER&&(c=i[l-1],c.length+=i[l].length,c.subType=Tokens.RANGE,i.length-=1),c.type=Tokens.NUMBER);else if(p===Tokens.SPACE)c.type===Tokens.SPACE&&(r=!0);else if(c.type===Tokens.MARKUP&&a[c.st]==s&&"=-~:*#`'>_".indexOf(s)>-1)r=!0;else if("."==s)t.links&&t.links.www&&3==c.length&&"www"==c.toLowerCase()&&(r=!0,c.type=Tokens.LINK);else if(t.wiki&&"'"==s&&"'"==a[c.en()])c.length>1?(c.length--,h--,g=Tokens.MARKUP):(r=!0,c.type=Tokens.MARKUP);else if("-"==s||c.subType==Tokens.LATIN&&("’"==s||"'"==s))c.type===Tokens.WORD&&(r=!0);else if("/"==s)t.links&&t.links.protocols&&i.length>2&&i[l-2].type===Tokens.WORD&&i[l-2].subType==Tokens.LATIN&&1==i[l-1].length&&":"==a[i[l-1].st]&&1==i[l].length&&"/"==a[i[l].st]&&(r=!0,c=i[l-2],c.length+=i[l-1].length+i[l].length,c.allUpper=c.allUpper&&i[l-1].allUpper&&i[l].allUpper,c.type=Tokens.LINK,i.length-=2);else if(t.html&&";"==s)l>0&&c.type===Tokens.WORD&&1==i[l-1].length&&"&"==a[i[l-1].st]?(r=!0,c=i[l-1],c.length+=i[l].length,c.allUpper=c.allUpper&&i[l-1].allUpper,c.type=Tokens.ENTITY,i.length-=1):l>1&&(c.type===Tokens.WORD||c.type===Tokens.NUMBER)&&1==i[l-1].length&&"#"==a[i[l-1].st]&&1==i[l-2].length&&"&"==a[i[l-2].st]&&(r=!0,c=i[l-2],c.length+=i[l-1].length+i[l].length,c.allUpper=c.allUpper&&i[l-1].allUpper&&i[l].allUpper,c.type=Tokens.ENTITY,i.length-=2);else if(t.markdown&&"["==s&&1==c.length&&"!"==a[c.st])r=!0,c.type=Tokens.MARKUP;else if(t.markdown&&"("==s&&1==c.length&&"]"==a[c.st])g=Tokens.MARKUP,u=Tokens.LINK;else if(t.wiki&&"{"==s&&1==c.length&&"{"==a[c.st])r=!0,c.type=Tokens.MARKUP,c.subType=Tokens.TEMPLATE;else if(t.wiki&&"["==s&&1==c.length&&"["==a[c.st])r=!0;else if(t.wiki&&"]"==s&&1==c.length&&"]"==a[c.st])r=!0;else if(t.wiki&&"|"==s&&!d){let e=-1;for(let t=l-1;t>=0;t--){if(2==i[t].length&&"["==a[i[t].st]&&"["==a[i[t].st+1]){e=t;break}if(1==i[t].length&&"|"==a[i[t].st]||i[t].indexOf("\n")>-1)break}if(e>-1){r=!0;for(let t=l-1;t>=e;t--)c=i[t],c.length+=i[t+1].length,c.allUpper=c.allUpper&&i[t+1].allUpper;l=e,i.length=l+1,c.subType=Tokens.LINK}}}else r=!0;else r=!0,c.type=Tokens.TAG,"!"==s?c.subType=Tokens.COMMENT:"/"==s&&(c.subType=Tokens.CLOSING);else r=!0,c.quote?s==c.quote&&"\\"!=a[c.en()]&&delete c.quote:'"'!=s&&"'"!=s||(c.quote=s);r?(c.length++,c.allUpper=c.allUpper&&k):(c=new Token(a,h,e+1-h,i.length,k,k,g,u),i.push(c))}return this}done(e,t){if(!e)return this.tokens;let s=getMatcher(e,t),n=[];for(let e=0;e<this.tokens.length;e++)s(this.tokens[e],e,this.tokens)&&n.push(this.tokens[e]);return n}get(e,t,s){if(e<0)return!1;if(!t)return this.tokens[e];let n=getMatcher(t,s),o=0;for(let t=0;t<this.tokens.length;t++)if(n(this.tokens[t],t,this.tokens)){if(o==e)return this.tokens[t];o++}return!1}count(e,t){if(!e)return this.tokens.length;let s=getMatcher(e,t),n=0;for(let e=0;e<this.tokens.length;e++)s(this.tokens[e],e,this.tokens)&&n++;return n}nextToken(e,t,s){let n=getMatcher(t,s),o=this.index;for(o++;o<this.tokens.length&&n(this.tokens[o],o,this.tokens);)o++;return o<this.tokens.length?(e&&(this.index=o),this.tokens[o]):null}punctAhead(){let e=this.nextToken(!1,["SPACE"],!0);return e&&"PUNCT"==e.type&&e}prevToken(e,t,s){let n=getMatcher(t,s),o=this.index;for(o--;o>=0&&n(this.tokens[o],o,this.tokens);)o--;return o>=0?(e&&(this.index=o),this.tokens[o]):null}punctBehind(){let e=this.prevToken(!1,["SPACE"],!0);return e&&"PUNCT"==e.type&&e}hasTokensAhead(e,t){return null!=this.nextToken(!1,e,t)}hasTokensBehind(e,t){return null!=this.prevToken(!1,e,t)}}function alwaysTrue(){return!0}function getMatcher(e,t){if(!e)return alwaysTrue();if("function"==typeof e)return e;let s,n=e;if("length"in e){s=!t,n={};for(let t=0;t<e.length;t++)n[e[t]]=!0}else s=t,t=!1;return function(e,o,a){if(e.subType){let s=e.type+"."+e.subType;if(s in n)return n[s]!=t}return e.type in n?n[e.type]!=t:!s}}Tokens.WORD="WORD",Tokens.NUMBER="NUMBER",Tokens.OTHER="OTHER",Tokens.DIGIT="DIGIT",Tokens.CYRIL="CYRIL",Tokens.LATIN="LATIN",Tokens.MIXED="MIXED",Tokens.PUNCT="PUNCT",Tokens.SPACE="SPACE",Tokens.MARKUP="MARKUP",Tokens.NEWLINE="NEWLINE",Tokens.EMAIL="EMAIL",Tokens.LINK="LINK",Tokens.HASHTAG="HASHTAG",Tokens.MENTION="MENTION",Tokens.TAG="TAG",Tokens.CONTENT="CONTENT",Tokens.SCRIPT="SCRIPT",Tokens.STYLE="STYLE",Tokens.COMMENT="COMMENT",Tokens.CLOSING="CLOSING",Tokens.TEMPLATE="TEMPLATE",Tokens.RANGE="RANGE",Tokens.ENTITY="ENTITY";export{Tokens};