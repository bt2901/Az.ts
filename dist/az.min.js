!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","../types"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("../types");var i,o;i=this,o=function(e){let t=-1,n=4294967295,i={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,127:127,1027:129,8225:135,1046:198,8222:132,1047:199,1168:165,1048:200,1113:154,1049:201,1045:197,1050:202,1028:170,160:160,1040:192,1051:203,164:164,166:166,167:167,169:169,171:171,172:172,173:173,174:174,1053:205,176:176,177:177,1114:156,181:181,182:182,183:183,8221:148,187:187,1029:189,1056:208,1057:209,1058:210,8364:136,1112:188,1115:158,1059:211,1060:212,1030:178,1061:213,1062:214,1063:215,1116:157,1064:216,1065:217,1031:175,1066:218,1067:219,1068:220,1069:221,1070:222,1032:163,8226:149,1071:223,1072:224,8482:153,1073:225,8240:137,1118:162,1074:226,1110:179,8230:133,1075:227,1033:138,1076:228,1077:229,8211:150,1078:230,1119:159,1079:231,1042:194,1080:232,1034:140,1025:168,1081:233,1082:234,8212:151,1083:235,1169:180,1084:236,1052:204,1085:237,1035:142,1086:238,1087:239,1088:240,1089:241,1090:242,1036:141,1041:193,1091:243,1092:244,8224:134,1093:245,8470:185,1094:246,1054:206,1095:247,1096:248,8249:139,1097:249,1098:250,1044:196,1099:251,1111:191,1055:207,1100:252,1038:161,8220:147,1101:253,8250:155,1102:254,8216:145,1103:255,1043:195,1105:184,1039:143,1026:128,1106:144,8218:130,1107:131,8217:146,1108:186,1109:190},o={};for(let e in i)o[i[e]]=String.fromCharCode(+e),delete o[0],delete o[1];let r={"й":"иёцыф","ц":"йфыву","у":"цывак","к":"увапе","е":"эикапрн","н":"епрог","г":"нролш","ш":"жголдщ","щ":"шлджз","з":"щджэх-","х":"зжэъ-","ъ":"ьхэ-ё","ф":"йцычяё","ы":"иойцувсчяф","в":"фцукамсчы","а":"оукепимсв","п":"кенртима","р":"енгоьтип","о":"ангшлбьтр","л":"гшщдюбьо","д":"шщзжюбл","ж":"шщзхэюд","э":"езхъжё","ё":"йфяъэ","я":"еёфыч","ч":"яфывс","с":"зчывам","м":"свапи","и":"йяемапрт","т":"дипроь","ь":"ътролб","б":"ьолдю","ю":"блдж",1:"ёйц",2:"йцу",3:"цук",4:"уке",5:"кен",6:"енг",7:"нгш",8:"гшщ",9:"шщз",0:"щзх-","-":"зхъ","=":"-хъ","\\":"ъэ",".":"южэ"};function s(e){return e>>10<<((512&e)>>6)&n}let l=function(e,t,n){this.units=e,this.guide=t,this.format=n};return l.fromArrayBuffer=function(e,t){let n=new DataView(e),i=n.getUint32(0,!0),o=n.getUint32(4*i+4,!0);return new l(new Uint32Array(e,4,i),new Uint8Array(e,4*i+8,2*o),t)},l.load=function(t,n,i){e.load(t,"arraybuffer",(function(e,t){i(e,e?null:l.fromArrayBuffer(t,n))}))},l.prototype.followByte=function(e,i){let o=(i^s(this.units[i])^255&e)&n;return(-2147483393&this.units[o]&n)!=(255&e)?t:o},l.prototype.followString=function(e,n){n=n||0;for(let o=0;o<e.length;o++){let r=e.charCodeAt(o);if(!(r in i))return t;if((n=this.followByte(i[r],n))==t)return t}return n},l.prototype.hasValue=function(e){return 0!=(256&this.units[e]&n)},l.prototype.value=function(e){let t=(e^s(this.units[e]))&n;return 2147483647&this.units[t]&n},l.prototype.find=function(e){let n=this.followString(e);return n==t?t:this.hasValue(n)?this.value(n):t},l.prototype.iterateAll=function(e){let n,i=[],o=[e],r=[],s=0;for(;;){if(e=o[o.length-1],0!=s)if(n=this.guide[e<<1],n){if((e=this.followByte(n,e))==t)return i;r.push(n),o.push(e)}else do{if(n=this.guide[1+(e<<1)],r.pop(),o.pop(),!o.length)return i;if(e=o[o.length-1],n){if((e=this.followByte(n,e))==t)return i;r.push(n),o.push(e)}}while(!n);for(;!this.hasValue(e);){let n=this.guide[e<<1];if(e=this.followByte(n,e),e==t)return i;r.push(n),o.push(e)}"words"==this.format?i.push([((1^r[0])<<6)+(r[1]>>1),((1^r[2])<<6)+(r[3]>>1)]):"probs"==this.format?i.push([((1^r[0])<<6)+(r[1]>>1),((1^r[2])<<6)+(r[3]>>1),((1^r[4])<<6)+(r[5]>>1)]):i.push(r.slice()),s=e}},l.prototype.findAll=function(e,n,s,l){l=l||0,s=s||0;let a,u,h,p,f,c,g,d=[],m=[["",0,0,0,0]];for(;m.length;)if(a=m.pop(),u=a[4],g=a[3],c=a[2],h=a[1],a=a[0],h!=e.length){if(n&&e[h]in n&&(p=n[e[h]].charCodeAt(0),p in i&&(f=this.followByte(i[p],u),f!=t&&m.push([a+n[e[h]],h+1,c,g,f]))),c<l&&g<=s){m.push([a,h+1,c+1,g,u]);let n=this.guide[u<<1];do{f=this.followByte(n,u),f!=t&&n in o&&m.push([a+o[n],h,c+1,g,f]),n=this.guide[1+(f<<1)]}while(f!=t);let s=r[e[h]];if(s)for(let e=0;e<s.length;e++)p=s.charCodeAt(e),p in i&&(f=this.followByte(i[p],u),f!=t&&m.push([a+s[e],h+1,c+1,g,f]));h<e.length-1&&(p=e.charCodeAt(h+1),p in i&&(f=this.followByte(i[p],u),f!=t&&(p=e.charCodeAt(h),p in i&&(f=this.followByte(i[p],f),f!=t&&m.push([a+e[h+1]+e[h],h+2,c+1,g,f])))))}if(p=e.charCodeAt(h),p in i&&(f=this.followByte(i[p],u),f!=t))for(m.push([a+e[h],h+1,c,g,f]);g<s&&c<=l&&h<e.length-1;){if(e[h]==e[h+1])m.push([a+e[h],h+2,c,g+1,f]),h++;else{if(!(h<e.length-2&&"-"==e[h+1]&&e[h]==e[h+2]))break;m.push([a+e[h],h+3,c,g+1,f]),h+=2}g++}}else{if(c<l&&g<=s){let e=this.guide[u<<1];do{f=this.followByte(e,u),f!=t&&e in o&&m.push([a+o[e],h,c+1,g,f]),e=this.guide[1+(f<<1)]}while(f!=t)}if("int"==this.format){this.hasValue(u)&&d.push([a,this.value(u)]);continue}if(("words"==this.format||"probs"==this.format)&&(u=this.followByte(1,u),u==t))continue;d.push([a,this.iterateAll(u),g,c])}return d},l},"object"==typeof t&&"undefined"!=typeof module?(module.exports=module.exports||{})&&(module.exports.DAWG=o(module.exports)):"function"==typeof n.define&&n.define.amd?(0,n.define)("Az.DAWG",["Az"],o):(i.Az=i.Az||{})&&(i.Az.DAWG=o(i.Az))})),function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","../types"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("../types");var i,o;i=this,o=function(e){let t,n,i,o,r,s,l,a=new Array(3),u=["","по","наи"],h={ignoreCase:!1,replacements:{"е":"ё"},stutter:1/0,typos:0,parsers:["Dictionary?","AbbrName?","AbbrPatronymic","IntNumber","RealNumber","Punctuation","RomanNumber?","Latin","HyphenParticle","HyphenAdverb","HyphenWords","PrefixKnown","PrefixUnknown?","SuffixKnown?","Abbr"],forceParse:!1,normalizeScore:!0},p="АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЭЮЯ",f=["-то","-ка","-таки","-де","-тко","-тка","-с","-ста"],c=["авиа","авто","аква","анти","анти-","антропо","архи","арт","арт-","астро","аудио","аэро","без","бес","био","вело","взаимо","вне","внутри","видео","вице-","вперед","впереди","гекто","гелио","гео","гетеро","гига","гигро","гипер","гипо","гомо","дву","двух","де","дез","дека","деци","дис","до","евро","за","зоо","интер","инфра","квази","квази-","кило","кино","контр","контр-","космо","космо-","крипто","лейб-","лже","лже-","макро","макси","макси-","мало","меж","медиа","медиа-","мега","мета","мета-","метео","метро","микро","милли","мини","мини-","моно","мото","много","мульти","нано","нарко","не","небез","недо","нейро","нео","низко","обер-","обще","одно","около","орто","палео","пан","пара","пента","пере","пиро","поли","полу","после","пост","пост-","порно","пра","пра-","пред","пресс-","противо","противо-","прото","псевдо","псевдо-","радио","разно","ре","ретро","ретро-","само","санти","сверх","сверх-","спец","суб","супер","супер-","супра","теле","тетра","топ-","транс","транс-","ультра","унтер-","штаб-","экзо","эко","эндо","эконом-","экс","экс-","экстра","экстра-","электро","энерго","этно"],g=[4,9],d=[],m=!1;function y(e){if("freeze"in Object)return Object.getOwnPropertyNames(e).forEach((function(t){let n=e[t];"object"==typeof n&&null!==n&&y(n)})),Object.freeze(e)}let b=function(e){let t,n=e.split(" ");this.stat=n[0].split(","),this.flex=n[1]?n[1].split(","):[];for(let e=0;e<2;e++){let n=this[["stat","flex"][e]];for(let e=0;e<n.length;e++){let i=n[e];for(this[i]=!0;o[i]&&(t=o[i].parent);)this[t]=i,i=t}}"POST"in this&&(this.POS=this.POST)};function w(e,t){let n=new b(e);return n.ext=new b(t),y(n)}b.prototype.toString=function(){return(this.stat.join(",")+" "+this.flex.join(",")).trim()},b.prototype.matches=function(e,t){if(!t){if("[object Array]"===Object.prototype.toString.call(e)){for(let t=0;t<e.length;t++)if(!this[e[t]])return!1;return!0}for(let t in e)if("[object Array]"===Object.prototype.toString.call(e[t])){if(!e[t].indexOf(this[t]))return!1}else if(e[t]!=this[t])return!1;return!0}e instanceof x&&(e=e.tag);for(let n=0;n<t.length;n++)if(e[t[n]]!=this[t[n]])return!1;return!0},b.prototype.isProductive=function(){return!(this.NUMR||this.NPRO||this.PRED||this.PREP||this.CONJ||this.PRCL||this.INTJ||this.Apro||this.NUMB||this.ROMN||this.LATN||this.PNCT||this.UNKN)},b.prototype.isCapitalized=function(){return this.Name||this.Surn||this.Patr||this.Geox||this.Init};let k=function(t,i){if(!m)throw new Error("Please call Az.Morph.init() before using this module.");i=i?e.extend(h,i):h;let o=[],r=!1;for(let e=0;e<i.parsers.length;e++){let n=i.parsers[e],s="?"!=n[n.length-1];if(n=s?n:n.slice(0,-1),n in k.Parsers){let e=k.Parsers[n](t,i);for(let t=0;t<e.length;t++)e[t].parser=n,e[t].stutterCnt||e[t].typosCnt||(r=!0);if(o=o.concat(e),r&&s)break}else console.warn('Parser "'+n+'" is not found. Skipping')}!o.length&&i.forceParse&&o.push(new x(t.toLocaleLowerCase(),l));let s=0;for(let e=0;e<o.length;e++)if("Dictionary"==o[e].parser){let t=n.findAll(o[e]+":"+o[e].tag);t&&t[0]&&(o[e].score=t[0][1]/1e6*C(o[e].stutterCnt,o[e].typosCnt),s+=o[e].score)}if(i.normalizeScore){if(s>0)for(let e=0;e<o.length;e++)"Dictionary"==o[e].parser&&(o[e].score/=s);s=0;for(let e=0;e<o.length;e++)"Dictionary"!=o[e].parser&&(s+=o[e].score);if(s>0)for(let e=0;e<o.length;e++)"Dictionary"!=o[e].parser&&(o[e].score/=s)}return o.sort((function(e,t){return t.score-e.score})),o};k.Parsers={};let x=function(e,t,n,i,o){this.word=e,this.tag=t,this.stutterCnt=i||0,this.typosCnt=o||0,this.score=n||0};function A(e,t,n){let i;if("auto"==n.typos){i=e.findAll(t,n.replacements,n.stutter,0);for(let o=0;o<g.length&&!i.length&&t.length>g[o];o++)i=e.findAll(t,n.replacements,n.stutter,o+1)}else i=e.findAll(t,n.replacements,n.stutter,n.typos);return i}function C(e,t){return Math.pow(.3,t)*Math.pow(.6,Math.min(e,1))}x.prototype.normalize=function(e){return this.inflect(e?{POS:this.tag.POS}:0)},x.prototype.inflect=function(e,t){return this},x.prototype.pluralize=function(e){return this.tag.NOUN||this.tag.ADJF||this.tag.PRTF?("number"==typeof e&&(e=(e%=100)%10==0||e%10>4||e>4&&e<21?"many":e%10==1?"one":"few"),!this.tag.NOUN||this.tag.nomn||this.tag.accs?"one"==e?this.inflect(["sing",this.tag.nomn?"nomn":"accs"]):this.tag.NOUN&&"few"==e?this.inflect(["sing","gent"]):(this.tag.ADJF||this.tag.PRTF)&&this.tag.femn&&"few"==e?this.inflect(["plur","nomn"]):this.inflect(["plur","gent"]):this.inflect(["one"==e?"sing":"plur",this.tag.CAse])):this},x.prototype.matches=function(e,t){return this.tag.matches(e,t)},x.prototype.toString=function(){return this.word},x.prototype.log=function(){console.group(this.toString()),console.log("Stutter?",this.stutterCnt,"Typos?",this.typosCnt),console.log(this.tag.ext.toString()),console.groupEnd()};let v=function(e,t,n,i,o,l,a){this.word=e,this.paradigmIdx=t,this.paradigm=r[t],this.formIdx=n,this.formCnt=this.paradigm.length/3,this.tag=s[this.paradigm[this.formCnt+n]],this.stutterCnt=i||0,this.typosCnt=o||0,this.score=C(this.stutterCnt,this.typosCnt),this.prefix=l||"",this.suffix=a||""};(v.prototype=Object.create(x.prototype)).constructor=v,v.prototype.base=function(){return this._base?this._base:this._base=this.word.substring(u[this.paradigm[(this.formCnt<<1)+this.formIdx]].length,this.word.length-i[this.paradigm[this.formIdx]].length)},v.prototype.inflect=function(e,t){if(!t&&"number"==typeof e)return new v(u[this.paradigm[(this.formCnt<<1)+e]]+this.base()+i[this.paradigm[e]],this.paradigmIdx,e,0,0,this.prefix,this.suffix);for(let n=0;n<this.formCnt;n++)if(s[this.paradigm[this.formCnt+n]].matches(e,t))return new v(u[this.paradigm[(this.formCnt<<1)+n]]+this.base()+i[this.paradigm[n]],this.paradigmIdx,n,0,0,this.prefix,this.suffix);return!1},v.prototype.log=function(){console.group(this.toString()),console.log("Stutter?",this.stutterCnt,"Typos?",this.typosCnt),console.log(u[this.paradigm[(this.formCnt<<1)+this.formIdx]]+"|"+this.base()+"|"+i[this.paradigm[this.formIdx]]),console.log(this.tag.ext.toString());let e=this.normalize();console.log("=> ",e+" ("+e.tag.ext.toString()+")"),e=this.normalize(!0),console.log("=> ",e+" ("+e.tag.ext.toString()+")"),console.groupCollapsed("Все формы: "+this.formCnt);for(let e=0;e<this.formCnt;e++){let t=this.inflect(e);console.log(t+" ("+t.tag.ext.toString()+")")}console.groupEnd(),console.groupEnd()},v.prototype.toString=function(){if(this.prefix){let e=u[this.paradigm[(this.formCnt<<1)+this.formIdx]];return e+this.prefix+this.word.substr(e.length)+this.suffix}return this.word+this.suffix};let T=function(e,t){this.left=e,this.right=t,this.tag=t.tag,this.score=e.score*t.score*.8,this.stutterCnt=e.stutterCnt+t.stutterCnt,this.typosCnt=e.typosCnt+t.typosCnt,"formCnt"in t&&(this.formCnt=t.formCnt)};return(T.prototype=Object.create(x.prototype)).constructor=T,T.prototype.inflect=function(e,t){let n,i=this.right.inflect(e,t);return n=t||"number"!=typeof e?this.left.inflect(e,t):this.left.inflect(i.tag,["POST","NMbr","CAse","PErs","TEns"]),!(!n||!i)&&new T(n,i)},T.prototype.toString=function(){return this.left.word+"-"+this.right.word},d.push((function(){k.Parsers.Dictionary=function(e,n){let i=!n.ignoreCase&&e.length&&e[0].toLocaleLowerCase()!=e[0]&&e.substr(1).toLocaleUpperCase()!=e.substr(1);e=e.toLocaleLowerCase();let o=A(t,e,n),r=[];for(let e=0;e<o.length;e++)for(let t=0;t<o[e][1].length;t++){let s=new v(o[e][0],o[e][1][t][0],o[e][1][t][1],o[e][2],o[e][3]);(n.ignoreCase||!s.tag.isCapitalized()||i)&&r.push(s)}return r};let e=[];for(let t=0;t<=2;t++)for(let n=0;n<=5;n++)for(let i=0;i<=1;i++)e.push(w("NOUN,inan,"+["masc","femn","neut"][t]+",Fixd,Abbr "+["sing","plur"][i]+","+["nomn","gent","datv","accs","ablt","loct"][n],"СУЩ,неод,"+["мр","жр","ср"][t]+",0,аббр "+["ед","мн"][i]+","+["им","рд","дт","вн","тв","пр"][n]));k.Parsers.Abbr=function(t,n){if(t.length<2)return[];if(t.indexOf("-")>-1)return[];if(p.indexOf(t[0])>-1&&p.indexOf(t[t.length-1])>-1){let n=0;for(let e=0;e<t.length;e++)p.indexOf(t[e])>-1&&n++;if(n<=5){let n=[];for(let i=0;i<e.length;i++){let o=new x(t,e[i],.5);n.push(o)}return n}}if(!n.ignoreCase||t.length>5)return[];t=t.toLocaleUpperCase();for(let e=0;e<t.length;e++)if(-1==p.indexOf(t[e]))return[];let i=[];for(let n=0;n<e.length;n++){let o=new x(t,e[n],.2);i.push(o)}return i};let n=function(e){let t=[];for(let e=0;e<=1;e++)for(let n=0;n<=5;n++)t.push(w("NOUN,anim,"+["masc","femn"][e]+",Sgtm,Name,Fixd,Abbr,Init sing,"+["nomn","gent","datv","accs","ablt","loct"][n],"СУЩ,од,"+["мр","жр"][e]+",sg,имя,0,аббр,иниц ед,"+["им","рд","дт","вн","тв","пр"][n]));return function(n,i){if(1!=n.length)return[];if(i.ignoreCase&&(n=n.toLocaleUpperCase()),-1==p.indexOf(n))return[];let o=[];for(let i=0;i<t.length;i++){let r=new x(n,t[i],e);o.push(r)}return o}};k.Parsers.AbbrName=n(.1),k.Parsers.AbbrPatronymic=n(.1);let i=function(e,t,n){return function(n,i){return i.ignoreCase&&(n=n.toLocaleUpperCase()),n.length&&n.match(e)?[new x(n,t)]:[]}};o.NUMB=o["ЧИСЛО"]=o.ROMN=o["РИМ"]=o.LATN=o["ЛАТ"]=o.PNCT=o["ЗПР"]=o.UNKN=o["НЕИЗВ"]={parent:"POST"},k.Parsers.IntNumber=i(/^[−-]?[0-9]+$/,w("NUMB,intg","ЧИСЛО,цел")),k.Parsers.RealNumber=i(/^[−-]?([0-9]*[.,][0-9]+)$/,w("NUMB,real","ЧИСЛО,вещ")),k.Parsers.Punctuation=i(/^[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]+$/,w("PNCT","ЗПР")),k.Parsers.RomanNumber=i(/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,w("ROMN","РИМ")),k.Parsers.Latin=i(/[A-Za-z\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u024f]$/,w("LATN","ЛАТ")),k.Parsers.HyphenParticle=function(e,n){e=e.toLocaleLowerCase();let i=[];for(let o=0;o<f.length;o++)if(e.substr(e.length-f[o].length)==f[o]){let r=e.slice(0,-f[o].length),s=A(t,r,n);for(let e=0;e<s.length;e++)for(let t=0;t<s[e][1].length;t++){let n=new v(s[e][0],s[e][1][t][0],s[e][1][t][1],s[e][2],s[e][3],"",f[o]);n.score*=.9,i.push(n)}}return i};let r=w("ADVB","Н");k.Parsers.HyphenAdverb=function(e,n){if((e=e.toLocaleLowerCase()).length<5||"по-"!=e.substr(0,3))return[];let i=A(t,e.substr(3),n),o=[],s={};for(let e=0;e<i.length;e++)if(!s[i[e][0]])for(let t=0;t<i[e][1].length;t++){let n=new v(i[e][0],i[e][1][t][0],i[e][1][t][1],i[e][2],i[e][3]);if(n.matches(["ADJF","sing","datv"])){s[i[e][0]]=!0,n=new x("по-"+i[e][0],r,.9*n.score,i[e][2],i[e][3]),o.push(n);break}}return o},k.Parsers.HyphenWords=function(e,t){e=e.toLocaleLowerCase();for(let t=0;t<c.length;t++)if("-"==c[t][c[t].length-1]&&e.substr(0,c[t].length)==c[t])return[];let n=[],i=e.split("-");if(2!=i.length||!i[0].length||!i[1].length){if(i.length>2){let o=i[i.length-1],r=k.Parsers.Dictionary(o,t);for(let t=0;t<r.length;t++)r[t]instanceof v&&(r[t].score*=.2,r[t].prefix=e.substr(0,e.length-o.length-1)+"-",n.push(r[t]))}return n}let o=k.Parsers.Dictionary(i[0],t),r=k.Parsers.Dictionary(i[1],t);for(let e=0;e<o.length;e++)if(!o[e].tag.Abbr)for(let i=0;i<r.length;i++)o[e].matches(r[i],["POST","NMbr","CAse","PErs","TEns"])&&(o[e].stutterCnt+r[i].stutterCnt>t.stutter||o[e].typosCnt+r[i].typosCnt>t.typos||n.push(new T(o[e],r[i])));for(let e=0;e<r.length;e++)r[e]instanceof v&&(r[e].score*=.3,r[e].prefix=i[0]+"-",n.push(r[e]));return n},k.Parsers.PrefixKnown=function(e,t){let n=!t.ignoreCase&&e.length&&e[0].toLocaleLowerCase()!=e[0]&&e.substr(1).toLocaleUpperCase()!=e.substr(1);e=e.toLocaleLowerCase();let i=[];for(let o=0;o<c.length;o++)if(!(e.length-c[o].length<3)&&e.substr(0,c[o].length)==c[o]){let r=e.substr(c[o].length),s=k.Parsers.Dictionary(r,t);for(let e=0;e<s.length;e++)s[e].tag.isProductive()&&(t.ignoreCase||!s[e].tag.isCapitalized()||n)&&(s[e].score*=.7,s[e].prefix=c[o],i.push(s[e]))}return i},k.Parsers.PrefixUnknown=function(e,t){let n=!t.ignoreCase&&e.length&&e[0].toLocaleLowerCase()!=e[0]&&e.substr(1).toLocaleUpperCase()!=e.substr(1);e=e.toLocaleLowerCase();let i=[];for(let o=1;o<=5&&!(e.length-o<3);o++){let r=e.substr(o),s=k.Parsers.Dictionary(r,t);for(let r=0;r<s.length;r++)s[r].tag.isProductive()&&(t.ignoreCase||!s[r].tag.isCapitalized()||n)&&(s[r].score*=.3,s[r].prefix=e.substr(0,o),i.push(s[r]))}return i},k.Parsers.SuffixKnown=function(e,t){if(e.length<4)return[];let n=!t.ignoreCase&&e.length&&e[0].toLocaleLowerCase()!=e[0]&&e.substr(1).toLocaleUpperCase()!=e.substr(1);e=e.toLocaleLowerCase();let i=[],o=1,r=[0,.2,.3,.4,.5,.6],s={};for(let l=0;l<u.length;l++){if(u[l].length&&e.substr(0,u[l].length)!=u[l])continue;let h=e.substr(u[l].length);for(let e=5;e>=o;e--){if(e>=h.length)continue;let p=h.substr(0,h.length-e),f=h.substr(h.length-e),c=a[l].findAll(f,t.replacements,0,0);if(!c)continue;let g=[],d=1;for(let i=0;i<c.length;i++){let o=c[i][0],a=c[i][1];for(let i=0;i<a.length;i++){let h=new v(u[l]+p+o,a[i][1],a[i][2]);if(!h.tag.isProductive())continue;if(!t.ignoreCase&&h.tag.isCapitalized()&&!n)continue;let f=h.toString()+":"+a[i][1]+":"+a[i][2];f in s||(d=Math.max(d,a[i][0]),h.score=a[i][0]*r[e],g.push(h),s[f]=!0)}}if(g.length>0){for(let e=0;e<g.length;e++)g[e].score/=d;i=i.concat(g),o=Math.max(e-1,1)}}}return i},l=w("UNKN","НЕИЗВ")})),k.setDefaults=function(e){h=e},k.init=function(l,u){let h,p,f=0;function c(){if(!--f){s=Array(h.length);for(let e=0;e<h.length;e++)s[e]=new b(h[e]),s[e].ext=new b(p[e]);s=y(s);for(let e=0;e<d.length;e++)d[e]();m=!0,u&&u(null,k)}}u||"function"!=typeof l||(u=l,l="string"==typeof __dirname?__dirname+"/../dicts":"dicts"),f++,e.DAWG.load(l+"/words.dawg","words",(function(e,n){e?u(e):(t=n,c())}));for(let t=0;t<3;t++)!function(t){f++,e.DAWG.load(l+"/prediction-suffixes-"+t+".dawg","probs",(function(e,n){e?u(e):(a[t]=n,c())}))}(t);f++,e.DAWG.load(l+"/p_t_given_w.intdawg","int",(function(e,t){e?u(e):(n=t,c())})),f++,e.load(l+"/grammemes.json","json",(function(e,t){if(e)u(e);else{o={};for(let e=0;e<t.length;e++)o[t[e][0]]=o[t[e][2]]={parent:t[e][1],internal:t[e][0],external:t[e][2],externalFull:t[e][3]};c()}})),f++,e.load(l+"/gramtab-opencorpora-int.json","json",(function(e,t){e?u(e):(h=t,c())})),f++,e.load(l+"/gramtab-opencorpora-ext.json","json",(function(e,t){e?u(e):(p=t,c())})),f++,e.load(l+"/suffixes.json","json",(function(e,t){e?u(e):(i=t,c())})),f++,e.load(l+"/paradigms.array","arraybuffer",(function(e,t){if(e)return void u(e);let n=new Uint16Array(t),i=n[0],o=1;r=[];for(let e=0;e<i;e++){let e=n[o++];r.push(n.subarray(o,o+e)),o+=e}c()}))},k},"object"==typeof t&&"undefined"!=typeof module?(module.exports=module.exports||{})&&(module.exports.Morph=o(module.exports)):"function"==typeof n.define&&n.define.amd?(0,n.define)("Az.Morph",["Az","Az.DAWG"],o):(i.Az=i.Az||{})&&(i.Az.Morph=o(i.Az))})),function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","../types"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("../types");var i,o;i=this,o=function(e){return function(){}},"object"==typeof t&&"undefined"!=typeof module?(module.exports=module.exports||{})&&(module.exports.Syntax=(module.exports,function(){})):"function"==typeof n.define&&n.define.amd?(0,n.define)("Az.Syntax",["Az"],o):(i.Az=i.Az||{})&&(i.Az.Syntax=(i.Az,function(){}))})),function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","../types"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("../types");var i,o;i=this,o=function(){let e="ac|ad|ae|aero|af|ag|ai|al|am|ao|aq|ar|arpa|as|asia|at|au|aw|ax|az|ba|bb|be|bf|bg|bh|bi|biz|bj|bm|bo|br|bs|bt|bv|bw|by|bz|ca|cat|cc|cd|cf|cg|ch|ci|cl|cm|cn|co|com|coop|cr|cu|cv|cw|cx|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|es|et|eu|fi|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|info|int|io|iq|ir|is|it|je|jo|jobs|jp|kg|ki|km|kn|kp|kr|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mn|mo|mobi|mp|mq|mr|ms|mt|mu|museum|mv|mw|mx|my|na|name|nc|ne|net|nf|ng|nl|no|nr|nu|nz|om|org|pa|pe|pf|ph|pk|pl|pm|pn|post|pr|pro|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tr|travel|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|yt|امارات|հայ|বাংলা|бел|中国|中國|الجزائر|مصر|ею|გე|ελ|香港|भारत|بھارت|భారత్|ભારત|ਭਾਰਤ|ভারত|இந்தியா|ایران|ايران|عراق|الاردن|한국|қаз|ලංකා|இலங்கை|المغرب|мкд|мон|澳門|澳门|مليسيا|عمان|پاکستان|پاكستان|فلسطين|срб|рф|قطر|السعودية|السعودیة|السعودیۃ|السعوديه|سودان|新加坡|சிங்கப்பூர்|سورية|سوريا|ไทย|تونس|台灣|台湾|臺灣|укр|اليمن|xxx|zm|aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|academy|accenture|accountant|accountants|aco|active|actor|adac|ads|adult|aeg|aetna|afamilycompany|afl|africa|africamagic|agakhan|agency|aig|aigo|airbus|airforce|airtel|akdn|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|aol|apartments|app|apple|aquarelle|arab|aramco|archi|army|art|arte|asda|associates|athleta|attorney|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aws|axa|azure|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bbc|bbt|bbva|bcg|bcn|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bharti|bible|bid|bike|bing|bingo|bio|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bms|bmw|bnl|bnpparibas|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|bradesco|bridgestone|broadway|broker|brother|brussels|budapest|bugatti|build|builders|business|buy|buzz|bzh|cab|cafe|cal|call|calvinklein|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|catering|catholic|cba|cbn|cbre|cbs|ceb|center|ceo|cern|cfa|cfd|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|coach|codes|coffee|college|cologne|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|corsica|country|coupon|coupons|courses|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cuisinella|cymru|cyou|dabur|dad|dance|date|dating|datsun|day|dclk|dds|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dnp|docs|dodge|dog|doha|domains|dot|download|drive|dstv|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dwg|earth|eat|edeka|education|email|emerck|emerson|energy|engineer|engineering|enterprises|epost|epson|equipment|ericsson|erni|esq|estate|esurance|etisalat|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|flickr|flights|flir|florist|flowers|flsmidth|fly|foo|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|gal|gallery|gallo|gallup|game|games|gap|garden|gbiz|gdn|gea|gent|genting|george|ggee|gift|gifts|gives|giving|glade|glass|gle|global|globo|gmail|gmbh|gmo|gmx|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gotv|grainger|graphics|gratis|green|gripe|group|guardian|gucci|guge|guide|guitars|guru|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hkt|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|host|hosting|hot|hoteles|hotmail|house|how|hsbc|htc|hughes|hyatt|hyundai|ibm|icbc|ice|icu|ieee|ifm|iinet|ikano|imamat|imdb|immo|immobilien|industries|infiniti|ing|ink|institute|insurance|insure|intel|international|intuit|investments|ipiranga|irish|iselect|ismaili|ist|istanbul|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|jeep|jetzt|jewelry|jio|jlc|jll|jmp|jnj|joburg|jot|joy|jpmorgan|jprs|juegos|juniper|kaufen|kddi|kerryhotels|kerrylogistics|kerryproperties|kfh|kia|kim|kinder|kindle|kitchen|kiwi|koeln|komatsu|kosher|kpmg|kpn|krd|kred|kuokgroup|kyknet|kyoto|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|ltd|ltda|lundbeck|lupin|luxe|luxury|macys|madrid|maif|maison|makeup|man|management|mango|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mcd|mcdonalds|mckinsey|med|media|meet|melbourne|meme|memorial|men|menu|meo|metlife|miami|microsoft|mini|mint|mit|mitsubishi|mlb|mls|mma|mnet|mobily|moda|moe|moi|mom|monash|money|monster|montblanc|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|msd|mtn|mtpc|mtr|multichoice|mutual|mutuelle|mzansimagic|nab|nadex|nagoya|naspers|nationwide|natura|navy|nba|nec|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nfl|ngo|nhk|nico|nike|nikon|ninja|nissan|nissay|nokia|northwesternmutual|norton|now|nowruz|nowtv|nra|nrw|ntt|nyc|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|organic|orientexpress|origins|osaka|otsuka|ott|ovh|page|pamperedchef|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|payu|pccw|pet|pfizer|pharmacy|philips|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|place|play|playstation|plumbing|plus|pnc|pohl|poker|politie|porn|pramerica|praxi|press|prime|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|pub|pwc|qpon|quebec|quest|qvc|racing|raid|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|rocher|rocks|rodeo|rogers|room|rsvp|ruhr|run|rwe|ryukyu|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sbi|sbs|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shopping|shouji|show|showtime|shriram|silk|sina|singles|site|ski|skin|sky|skype|sling|smart|smile|sncf|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|srl|srt|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|sucks|supersport|supplies|supply|support|surf|surgery|suzuki|swatch|swiftcover|swiss|sydney|symantec|systems|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tci|tdk|team|tech|technology|telecity|telefonica|temasek|tennis|teva|thd|theater|theatre|theguardian|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tjmaxx|tjx|tkmaxx|tmall|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|trade|trading|training|travelchannel|travelers|travelersinsurance|trust|trv|tube|tui|tunes|tushu|tvs|ubank|ubs|uconnect|unicom|university|uno|uol|ups|vacations|vana|vanguard|vegas|ventures|verisign|versicherung|vet|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vodka|volkswagen|volvo|vote|voting|voto|voyage|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|कॉम|セール|佛山|慈善|集团|在线|大众汽车|点看|คอม|八卦|موقع|一号店|公益|公司|香格里拉|网站|移动|我爱你|москва|католик|онлайн|сайт|联通|קום|时尚|微博|淡马锡|ファッション|орг|नेट|ストア|삼성|商标|商店|商城|дети|ポイント|新闻|工行|家電|كوم|中文网|中信|娱乐|谷歌|電訊盈科|购物|クラウド|通販|网店|संगठन|餐厅|网络|ком|诺基亚|食品|飞利浦|手表|手机|ارامكو|العليان|اتصالات|بازار|موبايلي|ابوظبي|كاثوليك|همراه|닷컴|政府|شبكة|بيتك|عرب|机构|组织机构|健康|рус|珠宝|大拿|みんな|グーグル|世界|書籍|网址|닷넷|コム|天主教|游戏|vermögensberater|vermögensberatung|企业|信息|嘉里大酒店|嘉里|广东|政务|xperia|xyz|yachts|yahoo|yamaxun|yandex|yodobashi|yoga|yokohama|you|youtube|yun|zappos|zara|zero|zip|zippo|zone|zuerich".split("|"),t={html:!1,wiki:!1,markdown:!1,hashtags:!0,mentions:!0,emails:!0,links:{protocols:!0,www:!1,tlds:{}}},i={nbsp:" ",quot:'"',gt:">",lt:"<",amp:"&",ndash:"–"};for(let n=0;n<e.length;n++)t.links.tlds[e[n]]=!0;let o=function(e,t,n,i,o,r,s,l){this.source=e,this.st=t,this.length=n,this.index=i,this.firstUpper=o,this.allUpper=r,this.type=s,l&&(this.subType=l)};o.prototype.toString=function(){return"_str"in this&&this._str.length==this.length?this._str:this._str=this.source.substr(this.st,this.length)},o.prototype.indexOf=function(e){if(1==e.length){for(let t=0;t<this.length;t++)if(this.source[this.st+t]==e)return t;return-1}return this.toString().indexOf(e)},o.prototype.toLowerCase=function(){return this.toString().toLocaleLowerCase()},o.prototype.isCapitalized=function(){return this.firstUpper&&!this.allUpper},o.prototype.en=function(){return this.st+this.length-1};let r=function(e,i){if(!(this instanceof r))return new r(e,i);this.tokens=[],this.source="","string"==typeof e?(this.config=i?n.Az.extend(t,i):t,this.append(e)):this.config=e?n.Az.extend(t,e):t,this.index=-1};function s(e,t){if(!e)return!0;if("function"==typeof e)return e;let n,i=e;if("length"in e){n=!t,i={};for(let t=0;t<e.length;t++)i[e[t]]=!0}else n=t,t=!1;return function(e,o,r){if(e.subType){let n=e.type+"."+e.subType;if(n in i)return i[n]!=t}return e.type in i?i[e.type]!=t:!n}}return r.WORD=new String("WORD"),r.NUMBER=new String("NUMBER"),r.OTHER=new String("OTHER"),r.DIGIT=new String("DIGIT"),r.CYRIL=new String("CYRIL"),r.LATIN=new String("LATIN"),r.MIXED=new String("MIXED"),r.PUNCT=new String("PUNCT"),r.SPACE=new String("SPACE"),r.MARKUP=new String("MARKUP"),r.NEWLINE=new String("NEWLINE"),r.EMAIL=new String("EMAIL"),r.LINK=new String("LINK"),r.HASHTAG=new String("HASHTAG"),r.MENTION=new String("MENTION"),r.TAG=new String("TAG"),r.CONTENT=new String("CONTENT"),r.SCRIPT=new String("SCRIPT"),r.STYLE=new String("STYLE"),r.COMMENT=new String("COMMENT"),r.CLOSING=new String("CLOSING"),r.TEMPLATE=new String("TEMPLATE"),r.RANGE=new String("RANGE"),r.ENTITY=new String("ENTITY"),r.prototype.append=function(e,s){(s=s?n.Az.extend(this.config,s):this.config).links&&!0===s.links.tlds&&(s.links.tlds=t.links.tlds);let l=this.source.length;this.source+=e;let a=this.source,u=this.tokens;for(let e=l;e<a.length;e++){let t=a[e],n=a.charCodeAt(e),l=!1,h=u.length-1,p=u[h],f=e;if(s.html&&";"==t)if(h>0&&p.type===r.WORD&&1==u[h-1].length&&"&"==a[u[h-1].st]){let e=p.toLowerCase();e in i&&(t=i[e],n=t.charCodeAt(0),h-=2,p=u[h],u.length=h+1)}else h>1&&(p.type===r.NUMBER||p.type===r.WORD&&"x"==a[p.st])&&1==u[h-1].length&&"#"==a[u[h-1].st]&&1==u[h-1].length&&"&"==a[u[h-1].st]&&(n="x"==a[p.st]?parseInt(p.toString().substr(1),16):parseInt(p.toString(),10),t=String.fromCharCode(n),h-=3,p=u[h],u.length=h+1);let c=r.OTHER,g=t.toLocaleLowerCase()!=t;n>=1024&&n<=1279&&(c=r.CYRIL),(n>=65&&n<=90||n>=97&&n<=122||n>=192&&n<=591)&&(c=r.LATIN),n>=48&&n<=57&&(c=r.DIGIT),(n<=32||n>=128&&n<=160)&&(c=r.SPACE),"‐-−‒–—―.…,:;?!¿¡()[]«»\"'’‘’“”/⁄".indexOf(t)>-1&&(c=r.PUNCT);let d=c,m=!1;c===r.CYRIL||c===r.LATIN?(d=r.WORD,m=c):c===r.DIGIT&&(d=r.NUMBER);let y=!p||"\n"==a[p.st+p.length-1];if(s.wiki&&(y&&":;*#~|".indexOf(t)>-1&&(d=r.MARKUP,m=r.NEWLINE),"={[|]}".indexOf(t)>-1&&(d=r.MARKUP)),s.markdown&&(y&&"=-#>+-".indexOf(t)>-1&&(d=r.MARKUP,m=r.NEWLINE),"[]*~_`\\".indexOf(t)>-1&&(d=r.MARKUP)),p)if(s.wiki&&"'"!=t&&1==p.length&&"'"==a[p.st]&&h>0&&u[h-1].type===r.WORD&&u[h-1].subType===r.LATIN&&(u[h-1].length+=p.length,h-=1,u.length=h+1,p=u[h]),s.links&&s.links.tlds&&(c===r.PUNCT||c===r.SPACE)&&u.length>2&&u[h-2].type===r.WORD&&1==u[h-1].length&&"."==a[u[h-1].st]&&u[h].type===r.WORD&&p.toString()in s.links.tlds){for(;h>=2&&u[h-2].type===r.WORD&&1==u[h-1].length&&("."==a[u[h-1].st]||"@"==a[u[h-1].st]||":"==a[u[h-1].st]);)h-=2,p=u[h],p.length+=u[h+1].length+u[h+2].length,p.allUpper=p.allUpper&&u[h+1].allUpper&&u[h+2].allUpper;s.emails&&p.indexOf("@")>-1&&-1==p.indexOf(":")?p.type=r.EMAIL:(p.type=r.LINK,"/"==t&&(l=!0)),u.length=h+1}else if(p.type===r.LINK)")"==t&&h>=1&&u[h-1].type===r.MARKUP&&1==u[h-1].length&&"("==a[u[h-1].st]?d=r.MARKUP:c!==r.SPACE&&","!=t&&"<"!=t&&(l=!0);else if(p.type===r.EMAIL)c!==r.CYRIL&&c!==r.LATIN&&"."!=t||(l=!0);else if(p.type===r.HASHTAG||p.type===r.MENTION)(c===r.CYRIL||c==r.LATIN||c==r.DIGIT||"_"==t||"@"==t&&-1==p.indexOf("@"))&&(l=!0);else if(p.type!==r.TAG||!p.quote&&">"==a[p.en()])if(p.type===r.CONTENT)l=!0,p.quote?t==p.quote&&"\\"!=a[p.en()]&&delete p.quote:'"'==t||"'"==t?p.quote=t:">"==t&&(p.length>=8&&"</script"==p.toString().substr(-8)?(p.length-=8,f-=8,l=!1,d=r.TAG,m=r.CLOSING):p.length>=7&&"</style"==p.toString().substr(-7)&&(p.length-=7,f-=7,l=!1,d=r.TAG,m=r.CLOSING));else if(p.type===r.TAG&&p.type!==r.CLOSING&&p.length>=8&&"script"==p.toLowerCase().substr(1,6))d=r.CONTENT,m=r.SCRIPT;else if(p.type===r.TAG&&p.type!==r.CLOSING&&p.length>=7&&"style"==p.toLowerCase().substr(1,5))d=r.CONTENT,m=r.STYLE;else if(!s.html||1!=p.length||"<"!=a[p.st]||c!==r.LATIN&&"!"!=t&&"/"!=t)if(p.type===r.CONTENT)l=!0;else if(p.type!==r.MARKUP||p.subType!=r.TEMPLATE||"}"==a[p.en()]&&"}"==a[p.en()-1]){if(p.type===r.MARKUP&&p.type===r.LINK&&")"!=a[p.en()])l=!0;else if(p.type===r.MARKUP&&"`"==a[p.st]&&p.subType===r.NEWLINE&&c===r.LATIN)l=!0;else if(c===r.CYRIL||c===r.LATIN)p.type===r.WORD?(l=!0,p.subType=p.subType==c?p.subType:r.MIXED):p.type===r.NUMBER?(l=!0,p.subType=p.subType&&p.subType!=c?r.MIXED:c):s.hashtags&&1==p.length&&"#"==a[p.st]?(l=!0,p.type=r.HASHTAG):!s.mentions||1!=p.length||"@"!=a[p.st]||0!=h&&u[h-1].type!==r.SPACE?c!==r.LATIN||1!=p.length||"'"!=a[p.st]&&"’"!=a[p.st]?1==p.length&&"-"==a[p.st]&&(l=!0,h>0&&u[h-1].type===r.NUMBER&&(p=u[h-1],p.length+=u[h].length,u.length-=1),p.type=r.WORD,p.subType=c):(l=!0,p.type=r.WORD,p.subType=r.LATIN):(l=!0,p.type=r.MENTION);else if(c===r.DIGIT)p.type===r.WORD?(l=!0,p.subType=r.MIXED):p.type===r.NUMBER?l=!0:1!=p.length||"+"!=a[p.st]&&"-"!=a[p.st]?1==p.length&&(","==a[p.st]||"."==a[p.st])&&u.length>1&&u[h-1].type===r.NUMBER&&(l=!0,p=u[h-1],p.length+=u[h].length,u.length-=1):(l=!0,h>0&&u[h-1].type===r.NUMBER&&(p=u[h-1],p.length+=u[h].length,p.subType=r.RANGE,u.length-=1),p.type=r.NUMBER);else if(c===r.SPACE)p.type===r.SPACE&&(l=!0);else if(p.type===r.MARKUP&&a[p.st]==t&&"=-~:*#`'>_".indexOf(t)>-1)l=!0;else if("."==t)s.links&&s.links.www&&3==p.length&&"www"==p.toLowerCase()&&(l=!0,p.type=r.LINK);else if(s.wiki&&"'"==t&&"'"==a[p.en()])p.length>1?(p.length--,f--,d=r.MARKUP):(l=!0,p.type=r.MARKUP);else if("-"==t||p.subType==r.LATIN&&("’"==t||"'"==t))p.type===r.WORD&&(l=!0);else if("/"==t)s.links&&s.links.protocols&&u.length>2&&u[h-2].type===r.WORD&&u[h-2].subType==r.LATIN&&1==u[h-1].length&&":"==a[u[h-1].st]&&1==u[h].length&&"/"==a[u[h].st]&&(l=!0,p=u[h-2],p.length+=u[h-1].length+u[h].length,p.allUpper=p.allUpper&&u[h-1].allUpper&&u[h].allUpper,p.type=r.LINK,u.length-=2);else if(s.html&&";"==t)h>0&&p.type===r.WORD&&1==u[h-1].length&&"&"==a[u[h-1].st]?(l=!0,p=u[h-1],p.length+=u[h].length,p.allUpper=p.allUpper&&u[h-1].allUpper,p.type=r.ENTITY,u.length-=1):h>1&&(p.type===r.WORD||p.type===r.NUMBER)&&1==u[h-1].length&&"#"==a[u[h-1].st]&&1==u[h-2].length&&"&"==a[u[h-2].st]&&(l=!0,p=u[h-2],p.length+=u[h-1].length+u[h].length,p.allUpper=p.allUpper&&u[h-1].allUpper&&u[h].allUpper,p.type=r.ENTITY,u.length-=2);else if(s.markdown&&"["==t&&1==p.length&&"!"==a[p.st])l=!0,p.type=r.MARKUP;else if(s.markdown&&"("==t&&1==p.length&&"]"==a[p.st])d=r.MARKUP,m=r.LINK;else if(s.wiki&&"{"==t&&1==p.length&&"{"==a[p.st])l=!0,p.type=r.MARKUP,p.subType=r.TEMPLATE;else if(s.wiki&&"["==t&&1==p.length&&"["==a[p.st])l=!0;else if(s.wiki&&"]"==t&&1==p.length&&"]"==a[p.st])l=!0;else if(s.wiki&&"|"==t&&!y){let e=-1;for(let t=h-1;t>=0;t--){if(2==u[t].length&&"["==a[u[t].st]&&"["==a[u[t].st+1]){e=t;break}if(1==u[t].length&&"|"==a[u[t].st]||u[t].indexOf("\n")>-1)break}if(e>-1){l=!0;for(let t=h-1;t>=e;t--)p=u[t],p.length+=u[t+1].length,p.allUpper=p.allUpper&&u[t+1].allUpper;h=e,u.length=h+1,p.subType=r.LINK}}}else l=!0;else l=!0,p.type=r.TAG,"!"==t?p.subType=r.COMMENT:"/"==t&&(p.subType=r.CLOSING);else l=!0,p.quote?t==p.quote&&"\\"!=a[p.en()]&&delete p.quote:'"'!=t&&"'"!=t||(p.quote=t);l?(p.length++,p.allUpper=p.allUpper&&g):(p=new o(a,f,e+1-f,u.length,g,g,d,m),u.push(p))}return this},r.prototype.done=function(e,t){if(!e)return this.tokens;let n=s(e,t),i=[];for(let e=0;e<this.tokens.length;e++)n(this.tokens[e],e,this.tokens)&&i.push(this.tokens[e]);return i},r.prototype.get=function(e,t,n){if(e<0)return!1;if(!t)return this.tokens[e];let i=s(t,n),o=0;for(let t=0;t<this.tokens.length;t++)if(i(this.tokens[t],t,this.tokens)){if(o==e)return this.tokens[t];o++}return!1},r.prototype.count=function(e,t){if(!e)return this.tokens.length;let n=s(e,t),i=0;for(let e=0;e<this.tokens.length;e++)n(this.tokens[e],e,this.tokens)&&i++;return i},r.prototype.nextToken=function(e,t,n){let i=s(t,n),o=this.index;for(o++;o<this.tokens.length&&i(this.tokens[o],o,this.tokens);)o++;return o<this.tokens.length?(e&&(this.index=o),this.tokens[o]):null},r.prototype.punctAhead=function(){let e=this.nextToken(!1,["SPACE"],!0);return e&&"PUNCT"==e.type&&e},r.prototype.prevToken=function(e,t,n){let i=s(t,n),o=this.index;for(o--;o>=0&&i(this.tokens[o],o,this.tokens);)o--;return o>=0?(e&&(this.index=o),this.tokens[o]):null},r.prototype.punctBehind=function(){let e=this.prevToken(!1,["SPACE"],!0);return e&&"PUNCT"==e.type&&e},r.prototype.hasTokensAhead=function(e,t){return null!=this.nextToken(!1,e,t)},r.prototype.hasTokensBehind=function(e,t){return null!=this.prevToken(!1,e,t)},r},"object"==typeof t&&"undefined"!=typeof module?(module.exports=module.exports||{})&&(module.exports.Tokens=o()):"function"==typeof n.define&&n.define.amd?(0,n.define)("Az.Tokens",["Az"],o):(i.Az=i.Az||{})&&(i.Az.Tokens=o())})),function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","../types"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("../types");var i,o;i=this,o=function(){let n;void 0!==e&&"object"==typeof t&&"undefined"!=typeof module&&(n=e("fs"));let i={load:function(e,t,i){if(n)return void n.readFile(e,{encoding:"json"==t?"utf8":null},(function(e,n){if(e)i(e);else if("json"==t)i(null,JSON.parse(n));else if("arraybuffer"==t)if(n.buffer)i(null,n.buffer);else{let e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let e=0;e<n.length;++e)t[e]=n[e];i(null,e)}else i(new Error("Unknown responseType"))}));let o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=t,o.onload=function(e){o.response&&i&&i(null,o.response)},o.send(null)},extend:function(){let e={};for(let t=0;t<arguments.length;t++)for(let n in arguments[t])e[n]=arguments[t][n];return e}};return i},"object"==typeof t&&"undefined"!=typeof module?module.exports=o():"function"==typeof n.define&&n.define.amd?(0,n.define)("Az",o):i.Az=o()}));
//# sourceMappingURL=az.min.js.map
